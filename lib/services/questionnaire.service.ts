// eFondaMental Platform - Questionnaire Service
// Typed service for handling specific questionnaire responses

import { createClient } from '@/lib/supabase/server';
import {
  AsrmResponse,
  AsrmResponseInsert,
  QidsResponse,
  QidsResponseInsert,
  MdqResponse,
  MdqResponseInsert,
  BipolarDiagnosticResponse,
  BipolarDiagnosticResponseInsert,
  OrientationResponse,
  OrientationResponseInsert,
  Eq5d5lResponse,
  Eq5d5lResponseInsert,
  PriseMResponse,
  PriseMResponseInsert,
  StaiYaResponse,
  StaiYaResponseInsert,
  MarsResponse,
  MarsResponseInsert,
  MathysResponse,
  MathysResponseInsert,
  PsqiResponse,
  PsqiResponseInsert,
  EpworthResponse,
  EpworthResponseInsert,
  AsrsResponse,
  AsrsResponseInsert,
  CtqResponse,
  CtqResponseInsert,
  Bis10Response,
  Bis10ResponseInsert,
  Als18Response,
  Als18ResponseInsert,
  AimResponse,
  AimResponseInsert,
  Wurs25Response,
  Wurs25ResponseInsert,
  Aq12Response,
  Aq12ResponseInsert,
  CsmResponse,
  CsmResponseInsert,
  CtiResponse,
  CtiResponseInsert
} from '@/lib/types/database.types';

// ============================================================================
// ASRM
// ============================================================================

export async function getAsrmResponse(
  visitId: string
): Promise<AsrmResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_asrm')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveAsrmResponse(
  response: AsrmResponseInsert
): Promise<AsrmResponse> {
  const supabase = await createClient();

  // Remove total_score if present (it's a generated column)
  const { total_score, ...responseWithoutGeneratedFields } = response as any;

  const { data, error } = await supabase
    .from('responses_asrm')
    .upsert(responseWithoutGeneratedFields, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// ============================================================================
// QIDS-SR16
// ============================================================================

export async function getQidsResponse(
  visitId: string
): Promise<QidsResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_qids_sr16')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveQidsResponse(
  response: QidsResponseInsert
): Promise<QidsResponse> {
  const supabase = await createClient();

  // Calculate QIDS score
  const sleepScore = Math.max(response.q1, response.q2, response.q3, response.q4);
  const appetiteWeightScore = Math.max(response.q6, response.q7, response.q8, response.q9);
  const psychomotorScore = Math.max(response.q15, response.q16);
  
  const totalScore = sleepScore + response.q5 + appetiteWeightScore + 
    response.q10 + response.q11 + response.q12 + 
    response.q13 + response.q14 + psychomotorScore;

  let interpretation = '';
  if (totalScore <= 5) interpretation = 'Pas de dépression';
  else if (totalScore <= 10) interpretation = 'Dépression légère';
  else if (totalScore <= 15) interpretation = 'Dépression modérée';
  else if (totalScore <= 20) interpretation = 'Dépression sévère';
  else interpretation = 'Dépression très sévère';

  const { data, error } = await supabase
    .from('responses_qids_sr16')
    .upsert({
      ...response,
      total_score: totalScore,
      interpretation
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// ============================================================================
// MDQ
// ============================================================================

export async function getMdqResponse(
  visitId: string
): Promise<MdqResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_mdq')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveMdqResponse(
  response: MdqResponseInsert
): Promise<MdqResponse> {
  const supabase = await createClient();

  // Remove total_score if present (added by questionnaire-renderer for COBRA, not valid for MDQ)
  const { total_score, ...responseWithoutTotalScore } = response as any;

  // Calculate MDQ Q1 score (sum of 13 items, each is 0 or 1)
  const q1Score = responseWithoutTotalScore.q1_1 + responseWithoutTotalScore.q1_2 + responseWithoutTotalScore.q1_3 + 
    responseWithoutTotalScore.q1_4 + responseWithoutTotalScore.q1_5 + responseWithoutTotalScore.q1_6 + 
    responseWithoutTotalScore.q1_7 + responseWithoutTotalScore.q1_8 + responseWithoutTotalScore.q1_9 + 
    responseWithoutTotalScore.q1_10 + responseWithoutTotalScore.q1_11 + responseWithoutTotalScore.q1_12 + 
    responseWithoutTotalScore.q1_13;

  // MDQ POSITIVE if: Q1 >= 7 AND Q2 = 1 (Yes) AND Q3 >= 2 ("Problème moyen" or "Problème sérieux")
  // Otherwise MDQ NEGATIVE
  const isPositive = q1Score >= 7 && responseWithoutTotalScore.q2 === 1 && (responseWithoutTotalScore.q3 !== null && responseWithoutTotalScore.q3 >= 2);
  const interpretation = isPositive ? 
    'MDQ Positif - Dépistage positif pour trouble bipolaire' : 
    'MDQ Négatif - Dépistage négatif pour trouble bipolaire';

  const { data, error } = await supabase
    .from('responses_mdq')
    .upsert({
      ...responseWithoutTotalScore,
      q1_score: q1Score,
      interpretation
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// ============================================================================
// Bipolar Diagnostic (EBIP_SCR_DIAG) - Medical Diagnostic Form
// ============================================================================

export async function getDiagnosticResponse(
  visitId: string
): Promise<BipolarDiagnosticResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_medical_diagnostic')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveDiagnosticResponse(
  response: BipolarDiagnosticResponseInsert
): Promise<BipolarDiagnosticResponse> {
  const supabase = await createClient();
  const user = await supabase.auth.getUser();

  const { data, error } = await supabase
    .from('responses_medical_diagnostic')
    .upsert({
      ...response,
      completed_by: user.data.user?.id
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// ============================================================================
// Bipolar Orientation (EBIP_SCR_ORIENT) - Specific to Bipolar Disorder
// ============================================================================

export async function getOrientationResponse(
  visitId: string
): Promise<OrientationResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_bipolar_orientation')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveOrientationResponse(
  response: OrientationResponseInsert
): Promise<OrientationResponse> {
  const supabase = await createClient();
  const user = await supabase.auth.getUser();

  const { data, error } = await supabase
    .from('responses_bipolar_orientation')
    .upsert({
      ...response,
      completed_by: user.data.user?.id
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// ============================================================================
// Pending Questionnaires
// ============================================================================

export async function getPendingQuestionnaires(patientId: string) {
  const supabase = await createClient();

  // Get latest screening visit for the patient
  const { data: visit } = await supabase
    .from('visits')
    .select('id, visit_type')
    .eq('patient_id', patientId)
    .eq('visit_type', 'screening')
    .in('status', ['scheduled', 'in_progress'])
    .order('scheduled_date', { ascending: false })
    .limit(1)
    .single();

  if (!visit) return [];

  // Check which questionnaires are completed
  const [asrm, qids, mdq] = await Promise.all([
    getAsrmResponse(visit.id),
    getQidsResponse(visit.id),
    getMdqResponse(visit.id)
  ]);

  const pending = [];
  if (!asrm) pending.push({
    id: 'ASRM_FR',
    title: 'Auto-Questionnaire Altman (ASRM)',
    description: "Échelle d'Auto-Évaluation de la Manie",
    estimatedTime: 5
  });
  if (!qids) pending.push({
    id: 'QIDS_SR16_FR',
    title: 'QIDS-SR16',
    description: 'Auto-questionnaire sur les symptômes de la dépression',
    estimatedTime: 10
  });
  if (!mdq) pending.push({
    id: 'MDQ_FR',
    title: 'MDQ - Questionnaire des Troubles de l\'Humeur',
    description: 'Outil de dépistage du trouble bipolaire',
    estimatedTime: 5
  });

  return pending;
}

// ============================================================================
// Initial Evaluation Questionnaires - ETAT Section
// ============================================================================

// EQ-5D-5L
export async function getEq5d5lResponse(
  visitId: string
): Promise<Eq5d5lResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_eq5d5l')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

// EQ-5D-5L France Crosswalk Value Set
// Maps 5-digit health state profiles to utility index values
// TODO: Paste the complete France crosswalk table here
const FRANCE_CROSSWALK: Record<string, number> = {
  "11111": 1.000,
  "11112": 0.929,
  "11113": 0.910,
  "11114": 0.769,
  "11115": 0.622,
  "11121": 0.910,
  "11122": 0.839,
  "11123": 0.820,
  "11124": 0.679,
  "11125": 0.532,
  "11131": 0.888,
  "11132": 0.817,
  "11133": 0.798,
  "11134": 0.657,
  "11135": 0.510,
  "11141": 0.757,
  "11142": 0.686,
  "11143": 0.667,
  "11144": 0.560,
  "11145": 0.449,
  "11151": 0.561,
  "11152": 0.490,
  "11153": 0.471,
  "11154": 0.415,
  "11155": 0.357,
  "11211": 0.875,
  "11212": 0.803,
  "11213": 0.785,
  "11214": 0.644,
  "11215": 0.497,
  "11221": 0.785,
  "11222": 0.714,
  "11223": 0.695,
  "11224": 0.554,
  "11225": 0.407,
  "11231": 0.763,
  "11232": 0.691,
  "11233": 0.673,
  "11234": 0.532,
  "11235": 0.385,
  "11241": 0.632,
  "11242": 0.561,
  "11243": 0.542,
  "11244": 0.435,
  "11245": 0.324,
  "11251": 0.436,
  "11252": 0.364,
  "11253": 0.346,
  "11254": 0.290,
  "11255": 0.232,
  "11311": 0.844,
  "11312": 0.773,
  "11313": 0.754,
  "11314": 0.613,
  "11315": 0.466,
  "11321": 0.754,
  "11322": 0.683,
  "11323": 0.664,
  "11324": 0.523,
  "11325": 0.376,
  "11331": 0.732,
  "11332": 0.661,
  "11333": 0.642,
  "11334": 0.501,
  "11335": 0.354,
  "11341": 0.601,
  "11342": 0.530,
  "11343": 0.511,
  "11344": 0.404,
  "11345": 0.293,
  "11351": 0.405,
  "11352": 0.334,
  "11353": 0.315,
  "11354": 0.259,
  "11355": 0.201,
  "11411": 0.776,
  "11412": 0.705,
  "11413": 0.686,
  "11414": 0.573,
  "11415": 0.455,
  "11421": 0.686,
  "11422": 0.615,
  "11423": 0.596,
  "11424": 0.483,
  "11425": 0.365,
  "11431": 0.664,
  "11432": 0.593,
  "11433": 0.574,
  "11434": 0.461,
  "11435": 0.343,
  "11441": 0.556,
  "11442": 0.485,
  "11443": 0.466,
  "11444": 0.376,
  "11445": 0.282,
  "11451": 0.394,
  "11452": 0.323,
  "11453": 0.304,
  "11454": 0.248,
  "11455": 0.190,
  "11511": 0.637,
  "11512": 0.566,
  "11513": 0.547,
  "11514": 0.491,
  "11515": 0.433,
  "11521": 0.547,
  "11522": 0.476,
  "11523": 0.457,
  "11524": 0.401,
  "11525": 0.343,
  "11531": 0.525,
  "11532": 0.454,
  "11533": 0.435,
  "11534": 0.379,
  "11535": 0.321,
  "11541": 0.464,
  "11542": 0.392,
  "11543": 0.374,
  "11544": 0.318,
  "11545": 0.260,
  "11551": 0.372,
  "11552": 0.301,
  "11553": 0.282,
  "11554": 0.226,
  "11555": 0.168,
  "12111": 0.823,
  "12112": 0.752,
  "12113": 0.733,
  "12114": 0.592,
  "12115": 0.445,
  "12121": 0.734,
  "12122": 0.662,
  "12123": 0.644,
  "12124": 0.502,
  "12125": 0.356,
  "12131": 0.711,
  "12132": 0.640,
  "12133": 0.621,
  "12134": 0.480,
  "12135": 0.333,
  "12141": 0.581,
  "12142": 0.509,
  "12143": 0.491,
  "12144": 0.384,
  "12145": 0.272,
  "12151": 0.384,
  "12152": 0.313,
  "12153": 0.294,
  "12154": 0.239,
  "12155": 0.180,
  "12211": 0.698,
  "12212": 0.627,
  "12213": 0.608,
  "12214": 0.467,
  "12215": 0.320,
  "12221": 0.609,
  "12222": 0.537,
  "12223": 0.519,
  "12224": 0.377,
  "12225": 0.231,
  "12231": 0.586,
  "12232": 0.515,
  "12233": 0.496,
  "12234": 0.355,
  "12235": 0.208,
  "12241": 0.456,
  "12242": 0.384,
  "12243": 0.366,
  "12244": 0.258,
  "12245": 0.147,
  "12251": 0.259,
  "12252": 0.188,
  "12253": 0.169,
  "12254": 0.113,
  "12255": 0.055,
  "12311": 0.667,
  "12312": 0.596,
  "12313": 0.577,
  "12314": 0.436,
  "12315": 0.289,
  "12321": 0.578,
  "12322": 0.506,
  "12323": 0.488,
  "12324": 0.346,
  "12325": 0.200,
  "12331": 0.555,
  "12332": 0.484,
  "12333": 0.465,
  "12334": 0.324,
  "12335": 0.177,
  "12341": 0.425,
  "12342": 0.353,
  "12343": 0.335,
  "12344": 0.228,
  "12345": 0.116,
  "12351": 0.228,
  "12352": 0.157,
  "12353": 0.138,
  "12354": 0.083,
  "12355": 0.024,
  "12411": 0.599,
  "12412": 0.528,
  "12413": 0.509,
  "12414": 0.396,
  "12415": 0.279,
  "12421": 0.510,
  "12422": 0.438,
  "12423": 0.420,
  "12424": 0.306,
  "12425": 0.189,
  "12431": 0.487,
  "12432": 0.416,
  "12433": 0.397,
  "12434": 0.284,
  "12435": 0.167,
  "12441": 0.380,
  "12442": 0.308,
  "12443": 0.290,
  "12444": 0.199,
  "12445": 0.106,
  "12451": 0.218,
  "12452": 0.146,
  "12453": 0.128,
  "12454": 0.072,
  "12455": 0.014,
  "12511": 0.460,
  "12512": 0.389,
  "12513": 0.370,
  "12514": 0.315,
  "12515": 0.256,
  "12521": 0.371,
  "12522": 0.299,
  "12523": 0.281,
  "12524": 0.225,
  "12525": 0.167,
  "12531": 0.348,
  "12532": 0.277,
  "12533": 0.258,
  "12534": 0.203,
  "12535": 0.144,
  "12541": 0.287,
  "12542": 0.216,
  "12543": 0.197,
  "12544": 0.141,
  "12545": 0.083,
  "12551": 0.195,
  "12552": 0.124,
  "12553": 0.105,
  "12554": 0.050,
  "12555": -0.009,
  "13111": 0.788,
  "13112": 0.717,
  "13113": 0.698,
  "13114": 0.557,
  "13115": 0.410,
  "13121": 0.698,
  "13122": 0.627,
  "13123": 0.608,
  "13124": 0.467,
  "13125": 0.320,
  "13131": 0.676,
  "13132": 0.605,
  "13133": 0.586,
  "13134": 0.445,
  "13135": 0.298,
  "13141": 0.545,
  "13142": 0.474,
  "13143": 0.455,
  "13144": 0.348,
  "13145": 0.237,
  "13151": 0.349,
  "13152": 0.278,
  "13153": 0.259,
  "13154": 0.203,
  "13155": 0.145,
  "13211": 0.663,
  "13212": 0.591,
  "13213": 0.573,
  "13214": 0.432,
  "13215": 0.285,
  "13221": 0.573,
  "13222": 0.502,
  "13223": 0.483,
  "13224": 0.342,
  "13225": 0.195,
  "13231": 0.551,
  "13232": 0.479,
  "13233": 0.461,
  "13234": 0.320,
  "13235": 0.173,
  "13241": 0.420,
  "13242": 0.349,
  "13243": 0.330,
  "13244": 0.223,
  "13245": 0.112,
  "13251": 0.224,
  "13252": 0.152,
  "13253": 0.134,
  "13254": 0.078,
  "13255": 0.020,
  "13311": 0.632,
  "13312": 0.561,
  "13313": 0.542,
  "13314": 0.401,
  "13315": 0.254,
  "13321": 0.542,
  "13322": 0.471,
  "13323": 0.452,
  "13324": 0.311,
  "13325": 0.164,
  "13331": 0.520,
  "13332": 0.449,
  "13333": 0.430,
  "13334": 0.289,
  "13335": 0.142,
  "13341": 0.389,
  "13342": 0.318,
  "13343": 0.299,
  "13344": 0.192,
  "13345": 0.081,
  "13351": 0.193,
  "13352": 0.122,
  "13353": 0.103,
  "13354": 0.047,
  "13355": -0.011,
  "13411": 0.564,
  "13412": 0.493,
  "13413": 0.474,
  "13414": 0.361,
  "13415": 0.243,
  "13421": 0.474,
  "13422": 0.403,
  "13423": 0.384,
  "13424": 0.271,
  "13425": 0.153,
  "13431": 0.452,
  "13432": 0.381,
  "13433": 0.362,
  "13434": 0.249,
  "13435": 0.131,
  "13441": 0.344,
  "13442": 0.273,
  "13443": 0.254,
  "13444": 0.164,
  "13445": 0.070,
  "13451": 0.182,
  "13452": 0.111,
  "13453": 0.092,
  "13454": 0.036,
  "13455": -0.022,
  "13511": 0.425,
  "13512": 0.354,
  "13513": 0.335,
  "13514": 0.279,
  "13515": 0.221,
  "13521": 0.335,
  "13522": 0.264,
  "13523": 0.245,
  "13524": 0.189,
  "13525": 0.131,
  "13531": 0.313,
  "13532": 0.242,
  "13533": 0.223,
  "13534": 0.167,
  "13535": 0.109,
  "13541": 0.252,
  "13542": 0.180,
  "13543": 0.162,
  "13544": 0.106,
  "13545": 0.048,
  "13551": 0.160,
  "13552": 0.089,
  "13553": 0.070,
  "13554": 0.014,
  "13555": -0.044,
  "14111": 0.718,
  "14112": 0.647,
  "14113": 0.628,
  "14114": 0.507,
  "14115": 0.382,
  "14121": 0.628,
  "14122": 0.557,
  "14123": 0.538,
  "14124": 0.418,
  "14125": 0.293,
  "14131": 0.606,
  "14132": 0.535,
  "14133": 0.516,
  "14134": 0.395,
  "14135": 0.270,
  "14141": 0.492,
  "14142": 0.421,
  "14143": 0.402,
  "14144": 0.308,
  "14145": 0.209,
  "14151": 0.321,
  "14152": 0.250,
  "14153": 0.231,
  "14154": 0.175,
  "14155": 0.117,
  "14211": 0.593,
  "14212": 0.521,
  "14213": 0.503,
  "14214": 0.382,
  "14215": 0.257,
  "14221": 0.503,
  "14222": 0.432,
  "14223": 0.413,
  "14224": 0.293,
  "14225": 0.167,
  "14231": 0.481,
  "14232": 0.409,
  "14233": 0.391,
  "14234": 0.270,
  "14235": 0.145,
  "14241": 0.367,
  "14242": 0.296,
  "14243": 0.277,
  "14244": 0.182,
  "14245": 0.084,
  "14251": 0.196,
  "14252": 0.125,
  "14253": 0.106,
  "14254": 0.050,
  "14255": -0.008,
  "14311": 0.562,
  "14312": 0.491,
  "14313": 0.472,
  "14314": 0.351,
  "14315": 0.226,
  "14321": 0.472,
  "14322": 0.401,
  "14323": 0.382,
  "14324": 0.262,
  "14325": 0.137,
  "14331": 0.450,
  "14332": 0.379,
  "14333": 0.360,
  "14334": 0.239,
  "14335": 0.114,
  "14341": 0.336,
  "14342": 0.265,
  "14343": 0.246,
  "14344": 0.152,
  "14345": 0.053,
  "14351": 0.165,
  "14352": 0.094,
  "14353": 0.075,
  "14354": 0.019,
  "14355": -0.039,
  "14411": 0.508,
  "14412": 0.436,
  "14413": 0.418,
  "14414": 0.319,
  "14415": 0.215,
  "14421": 0.418,
  "14422": 0.347,
  "14423": 0.328,
  "14424": 0.229,
  "14425": 0.126,
  "14431": 0.396,
  "14432": 0.324,
  "14433": 0.306,
  "14434": 0.207,
  "14435": 0.103,
  "14441": 0.299,
  "14442": 0.228,
  "14443": 0.209,
  "14444": 0.127,
  "14445": 0.042,
  "14451": 0.154,
  "14452": 0.083,
  "14453": 0.064,
  "14454": 0.009,
  "14455": -0.050,
  "14511": 0.397,
  "14512": 0.326,
  "14513": 0.307,
  "14514": 0.251,
  "14515": 0.193,
  "14521": 0.308,
  "14522": 0.236,
  "14523": 0.218,
  "14524": 0.162,
  "14525": 0.104,
  "14531": 0.285,
  "14532": 0.214,
  "14533": 0.195,
  "14534": 0.139,
  "14535": 0.081,
  "14541": 0.224,
  "14542": 0.153,
  "14543": 0.134,
  "14544": 0.078,
  "14545": 0.020,
  "14551": 0.132,
  "14552": 0.061,
  "14553": 0.042,
  "14554": -0.014,
  "14555": -0.072,
  "15111": 0.500,
  "15112": 0.429,
  "15113": 0.410,
  "15114": 0.354,
  "15115": 0.296,
  "15121": 0.410,
  "15122": 0.339,
  "15123": 0.320,
  "15124": 0.264,
  "15125": 0.206,
  "15131": 0.388,
  "15132": 0.317,
  "15133": 0.298,
  "15134": 0.242,
  "15135": 0.184,
  "15141": 0.327,
  "15142": 0.255,
  "15143": 0.237,
  "15144": 0.181,
  "15145": 0.123,
  "15151": 0.235,
  "15152": 0.164,
  "15153": 0.145,
  "15154": 0.089,
  "15155": 0.031,
  "15211": 0.375,
  "15212": 0.303,
  "15213": 0.285,
  "15214": 0.229,
  "15215": 0.171,
  "15221": 0.285,
  "15222": 0.214,
  "15223": 0.195,
  "15224": 0.139,
  "15225": 0.081,
  "15231": 0.263,
  "15232": 0.191,
  "15233": 0.173,
  "15234": 0.117,
  "15235": 0.059,
  "15241": 0.202,
  "15242": 0.130,
  "15243": 0.112,
  "15244": 0.056,
  "15245": -0.002,
  "15251": 0.110,
  "15252": 0.038,
  "15253": 0.020,
  "15254": -0.036,
  "15255": -0.094,
  "15311": 0.344,
  "15312": 0.273,
  "15313": 0.254,
  "15314": 0.198,
  "15315": 0.140,
  "15321": 0.254,
  "15322": 0.183,
  "15323": 0.164,
  "15324": 0.108,
  "15325": 0.050,
  "15331": 0.232,
  "15332": 0.161,
  "15333": 0.142,
  "15334": 0.086,
  "15335": 0.028,
  "15341": 0.171,
  "15342": 0.099,
  "15343": 0.081,
  "15344": 0.025,
  "15345": -0.033,
  "15351": 0.079,
  "15352": 0.008,
  "15353": -0.011,
  "15354": -0.067,
  "15355": -0.125,
  "15411": 0.333,
  "15412": 0.262,
  "15413": 0.243,
  "15414": 0.187,
  "15415": 0.129,
  "15421": 0.243,
  "15422": 0.172,
  "15423": 0.153,
  "15424": 0.097,
  "15425": 0.039,
  "15431": 0.221,
  "15432": 0.150,
  "15433": 0.131,
  "15434": 0.075,
  "15435": 0.017,
  "15441": 0.160,
  "15442": 0.089,
  "15443": 0.070,
  "15444": 0.014,
  "15445": -0.044,
  "15451": 0.068,
  "15452": -0.003,
  "15453": -0.022,
  "15454": -0.078,
  "15455": -0.136,
  "15511": 0.311,
  "15512": 0.240,
  "15513": 0.221,
  "15514": 0.165,
  "15515": 0.107,
  "15521": 0.221,
  "15522": 0.150,
  "15523": 0.131,
  "15524": 0.075,
  "15525": 0.017,
  "15531": 0.199,
  "15532": 0.128,
  "15533": 0.109,
  "15534": 0.053,
  "15535": -0.005,
  "15541": 0.138,
  "15542": 0.066,
  "15543": 0.048,
  "15544": -0.008,
  "15545": -0.066,
  "15551": 0.046,
  "15552": -0.025,
  "15553": -0.044,
  "15554": -0.100,
  "15555": -0.158,
  "21111": 0.872,
  "21112": 0.801,
  "21113": 0.782,
  "21114": 0.641,
  "21115": 0.494,
  "21121": 0.783,
  "21122": 0.711,
  "21123": 0.693,
  "21124": 0.551,
  "21125": 0.405,
  "21131": 0.760,
  "21132": 0.689,
  "21133": 0.670,
  "21134": 0.529,
  "21135": 0.382,
  "21141": 0.630,
  "21142": 0.558,
  "21143": 0.540,
  "21144": 0.433,
  "21145": 0.321,
  "21151": 0.433,
  "21152": 0.362,
  "21153": 0.343,
  "21154": 0.288,
  "21155": 0.229,
  "21211": 0.747,
  "21212": 0.676,
  "21213": 0.657,
  "21214": 0.516,
  "21215": 0.369,
  "21221": 0.658,
  "21222": 0.586,
  "21223": 0.568,
  "21224": 0.426,
  "21225": 0.280,
  "21231": 0.635,
  "21232": 0.564,
  "21233": 0.545,
  "21234": 0.404,
  "21235": 0.257,
  "21241": 0.505,
  "21242": 0.433,
  "21243": 0.415,
  "21244": 0.308,
  "21245": 0.196,
  "21251": 0.308,
  "21252": 0.237,
  "21253": 0.218,
  "21254": 0.162,
  "21255": 0.104,
  "21311": 0.716,
  "21312": 0.645,
  "21313": 0.626,
  "21314": 0.485,
  "21315": 0.338,
  "21321": 0.627,
  "21322": 0.555,
  "21323": 0.537,
  "21324": 0.395,
  "21325": 0.249,
  "21331": 0.604,
  "21332": 0.533,
  "21333": 0.514,
  "21334": 0.373,
  "21335": 0.226,
  "21341": 0.474,
  "21342": 0.402,
  "21343": 0.384,
  "21344": 0.277,
  "21345": 0.165,
  "21351": 0.277,
  "21352": 0.206,
  "21353": 0.187,
  "21354": 0.132,
  "21355": 0.073,
  "21411": 0.649,
  "21412": 0.577,
  "21413": 0.559,
  "21414": 0.445,
  "21415": 0.328,
  "21421": 0.559,
  "21422": 0.487,
  "21423": 0.469,
  "21424": 0.356,
  "21425": 0.238,
  "21431": 0.537,
  "21432": 0.465,
  "21433": 0.447,
  "21434": 0.333,
  "21435": 0.216,
  "21441": 0.429,
  "21442": 0.357,
  "21443": 0.339,
  "21444": 0.248,
  "21445": 0.155,
  "21451": 0.267,
  "21452": 0.195,
  "21453": 0.177,
  "21454": 0.121,
  "21455": 0.063,
  "21511": 0.509,
  "21512": 0.438,
  "21513": 0.419,
  "21514": 0.364,
  "21515": 0.305,
  "21521": 0.420,
  "21522": 0.348,
  "21523": 0.330,
  "21524": 0.274,
  "21525": 0.216,
  "21531": 0.397,
  "21532": 0.326,
  "21533": 0.307,
  "21534": 0.252,
  "21535": 0.193,
  "21541": 0.336,
  "21542": 0.265,
  "21543": 0.246,
  "21544": 0.190,
  "21545": 0.132,
  "21551": 0.244,
  "21552": 0.173,
  "21553": 0.154,
  "21554": 0.099,
  "21555": 0.040,
  "22111": 0.696,
  "22112": 0.625,
  "22113": 0.606,
  "22114": 0.465,
  "22115": 0.318,
  "22121": 0.606,
  "22122": 0.535,
  "22123": 0.516,
  "22124": 0.375,
  "22125": 0.228,
  "22131": 0.584,
  "22132": 0.513,
  "22133": 0.494,
  "22134": 0.353,
  "22135": 0.206,
  "22141": 0.453,
  "22142": 0.382,
  "22143": 0.363,
  "22144": 0.256,
  "22145": 0.145,
  "22151": 0.257,
  "22152": 0.186,
  "22153": 0.167,
  "22154": 0.111,
  "22155": 0.053,
  "22211": 0.571,
  "22212": 0.499,
  "22213": 0.481,
  "22214": 0.340,
  "22215": 0.193,
  "22221": 0.481,
  "22222": 0.410,
  "22223": 0.391,
  "22224": 0.250,
  "22225": 0.103,
  "22231": 0.459,
  "22232": 0.387,
  "22233": 0.369,
  "22234": 0.228,
  "22235": 0.081,
  "22241": 0.328,
  "22242": 0.257,
  "22243": 0.238,
  "22244": 0.131,
  "22245": 0.020,
  "22251": 0.132,
  "22252": 0.060,
  "22253": 0.042,
  "22254": -0.014,
  "22255": -0.072,
  "22311": 0.540,
  "22312": 0.469,
  "22313": 0.450,
  "22314": 0.309,
  "22315": 0.162,
  "22321": 0.450,
  "22322": 0.379,
  "22323": 0.360,
  "22324": 0.219,
  "22325": 0.072,
  "22331": 0.428,
  "22332": 0.357,
  "22333": 0.338,
  "22334": 0.197,
  "22335": 0.050,
  "22341": 0.297,
  "22342": 0.226,
  "22343": 0.207,
  "22344": 0.100,
  "22345": -0.011,
  "22351": 0.101,
  "22352": 0.030,
  "22353": 0.011,
  "22354": -0.045,
  "22355": -0.103,
  "22411": 0.472,
  "22412": 0.401,
  "22413": 0.382,
  "22414": 0.269,
  "22415": 0.151,
  "22421": 0.382,
  "22422": 0.311,
  "22423": 0.292,
  "22424": 0.179,
  "22425": 0.061,
  "22431": 0.360,
  "22432": 0.289,
  "22433": 0.270,
  "22434": 0.157,
  "22435": 0.039,
  "22441": 0.252,
  "22442": 0.181,
  "22443": 0.162,
  "22444": 0.072,
  "22445": -0.022,
  "22451": 0.090,
  "22452": 0.019,
  "22453": 0.000,
  "22454": -0.056,
  "22455": -0.114,
  "22511": 0.333,
  "22512": 0.262,
  "22513": 0.243,
  "22514": 0.187,
  "22515": 0.129,
  "22521": 0.243,
  "22522": 0.172,
  "22523": 0.153,
  "22524": 0.097,
  "22525": 0.039,
  "22531": 0.221,
  "22532": 0.150,
  "22533": 0.131,
  "22534": 0.075,
  "22535": 0.017,
  "22541": 0.160,
  "22542": 0.088,
  "22543": 0.070,
  "22544": 0.014,
  "22545": -0.044,
  "22551": 0.068,
  "22552": -0.003,
  "22553": -0.022,
  "22554": -0.078,
  "22555": -0.136,
  "23111": 0.660,
  "23112": 0.589,
  "23113": 0.570,
  "23114": 0.429,
  "23115": 0.282,
  "23121": 0.571,
  "23122": 0.499,
  "23123": 0.481,
  "23124": 0.339,
  "23125": 0.193,
  "23131": 0.548,
  "23132": 0.477,
  "23133": 0.458,
  "23134": 0.317,
  "23135": 0.170,
  "23141": 0.418,
  "23142": 0.346,
  "23143": 0.328,
  "23144": 0.221,
  "23145": 0.109,
  "23151": 0.221,
  "23152": 0.150,
  "23153": 0.131,
  "23154": 0.076,
  "23155": 0.017,
  "23211": 0.535,
  "23212": 0.464,
  "23213": 0.445,
  "23214": 0.304,
  "23215": 0.157,
  "23221": 0.446,
  "23222": 0.374,
  "23223": 0.356,
  "23224": 0.214,
  "23225": 0.068,
  "23231": 0.423,
  "23232": 0.352,
  "23233": 0.333,
  "23234": 0.192,
  "23235": 0.045,
  "23241": 0.293,
  "23242": 0.221,
  "23243": 0.203,
  "23244": 0.096,
  "23245": -0.016,
  "23251": 0.096,
  "23252": 0.025,
  "23253": 0.006,
  "23254": -0.050,
  "23255": -0.108,
  "23311": 0.504,
  "23312": 0.433,
  "23313": 0.414,
  "23314": 0.273,
  "23315": 0.126,
  "23321": 0.415,
  "23322": 0.343,
  "23323": 0.325,
  "23324": 0.183,
  "23325": 0.037,
  "23331": 0.392,
  "23332": 0.321,
  "23333": 0.302,
  "23334": 0.161,
  "23335": 0.014,
  "23341": 0.262,
  "23342": 0.190,
  "23343": 0.172,
  "23344": 0.065,
  "23345": -0.047,
  "23351": 0.065,
  "23352": -0.006,
  "23353": -0.025,
  "23354": -0.080,
  "23355": -0.139,
  "23411": 0.437,
  "23412": 0.365,
  "23413": 0.347,
  "23414": 0.233,
  "23415": 0.116,
  "23421": 0.347,
  "23422": 0.275,
  "23423": 0.257,
  "23424": 0.144,
  "23425": 0.026,
  "23431": 0.325,
  "23432": 0.253,
  "23433": 0.235,
  "23434": 0.121,
  "23435": 0.004,
  "23441": 0.217,
  "23442": 0.145,
  "23443": 0.127,
  "23444": 0.036,
  "23445": -0.057,
  "23451": 0.055,
  "23452": -0.017,
  "23453": -0.035,
  "23454": -0.091,
  "23455": -0.149,
  "23511": 0.297,
  "23512": 0.226,
  "23513": 0.207,
  "23514": 0.152,
  "23515": 0.093,
  "23521": 0.208,
  "23522": 0.136,
  "23523": 0.118,
  "23524": 0.062,
  "23525": 0.004,
  "23531": 0.185,
  "23532": 0.114,
  "23533": 0.095,
  "23534": 0.040,
  "23535": -0.019,
  "23541": 0.124,
  "23542": 0.053,
  "23543": 0.034,
  "23544": -0.022,
  "23545": -0.080,
  "23551": 0.032,
  "23552": -0.039,
  "23553": -0.058,
  "23554": -0.113,
  "23555": -0.172,
  "24111": 0.590,
  "24112": 0.519,
  "24113": 0.500,
  "24114": 0.380,
  "24115": 0.255,
  "24121": 0.501,
  "24122": 0.429,
  "24123": 0.411,
  "24124": 0.290,
  "24125": 0.165,
  "24131": 0.478,
  "24132": 0.407,
  "24133": 0.388,
  "24134": 0.268,
  "24135": 0.143,
  "24141": 0.365,
  "24142": 0.293,
  "24143": 0.275,
  "24144": 0.180,
  "24145": 0.082,
  "24151": 0.194,
  "24152": 0.122,
  "24153": 0.104,
  "24154": 0.048,
  "24155": -0.010,
  "24211": 0.465,
  "24212": 0.394,
  "24213": 0.375,
  "24214": 0.255,
  "24215": 0.130,
  "24221": 0.376,
  "24222": 0.304,
  "24223": 0.286,
  "24224": 0.165,
  "24225": 0.040,
  "24231": 0.353,
  "24232": 0.282,
  "24233": 0.263,
  "24234": 0.143,
  "24235": 0.018,
  "24241": 0.240,
  "24242": 0.168,
  "24243": 0.150,
  "24244": 0.055,
  "24245": -0.043,
  "24251": 0.069,
  "24252": -0.003,
  "24253": -0.021,
  "24254": -0.077,
  "24255": -0.135,
  "24311": 0.434,
  "24312": 0.363,
  "24313": 0.344,
  "24314": 0.224,
  "24315": 0.099,
  "24321": 0.345,
  "24322": 0.273,
  "24323": 0.255,
  "24324": 0.134,
  "24325": 0.009,
  "24331": 0.322,
  "24332": 0.251,
  "24333": 0.232,
  "24334": 0.112,
  "24335": -0.013,
  "24341": 0.209,
  "24342": 0.137,
  "24343": 0.119,
  "24344": 0.024,
  "24345": -0.074,
  "24351": 0.038,
  "24352": -0.034,
  "24353": -0.052,
  "24354": -0.108,
  "24355": -0.166,
  "24411": 0.380,
  "24412": 0.309,
  "24413": 0.290,
  "24414": 0.191,
  "24415": 0.088,
  "24421": 0.291,
  "24422": 0.219,
  "24423": 0.201,
  "24424": 0.101,
  "24425": -0.002,
  "24431": 0.268,
  "24432": 0.197,
  "24433": 0.178,
  "24434": 0.079,
  "24435": -0.024,
  "24441": 0.172,
  "24442": 0.101,
  "24443": 0.082,
  "24444": 0.000,
  "24445": -0.085,
  "24451": 0.027,
  "24452": -0.044,
  "24453": -0.063,
  "24454": -0.119,
  "24455": -0.177,
  "24511": 0.270,
  "24512": 0.198,
  "24513": 0.180,
  "24514": 0.124,
  "24515": 0.066,
  "24521": 0.180,
  "24522": 0.109,
  "24523": 0.090,
  "24524": 0.034,
  "24525": -0.024,
  "24531": 0.158,
  "24532": 0.086,
  "24533": 0.068,
  "24534": 0.012,
  "24535": -0.046,
  "24541": 0.097,
  "24542": 0.025,
  "24543": 0.007,
  "24544": -0.049,
  "24545": -0.107,
  "24551": 0.005,
  "24552": -0.067,
  "24553": -0.085,
  "24554": -0.141,
  "24555": -0.199,
  "25111": 0.372,
  "25112": 0.301,
  "25113": 0.282,
  "25114": 0.227,
  "25115": 0.168,
  "25121": 0.283,
  "25122": 0.211,
  "25123": 0.193,
  "25124": 0.137,
  "25125": 0.079,
  "25131": 0.260,
  "25132": 0.189,
  "25133": 0.170,
  "25134": 0.115,
  "25135": 0.056,
  "25141": 0.199,
  "25142": 0.128,
  "25143": 0.109,
  "25144": 0.053,
  "25145": -0.005,
  "25151": 0.107,
  "25152": 0.036,
  "25153": 0.017,
  "25154": -0.038,
  "25155": -0.097,
  "25211": 0.247,
  "25212": 0.176,
  "25213": 0.157,
  "25214": 0.101,
  "25215": 0.043,
  "25221": 0.158,
  "25222": 0.086,
  "25223": 0.068,
  "25224": 0.012,
  "25225": -0.046,
  "25231": 0.135,
  "25232": 0.064,
  "25233": 0.045,
  "25234": -0.011,
  "25235": -0.069,
  "25241": 0.074,
  "25242": 0.003,
  "25243": -0.016,
  "25244": -0.072,
  "25245": -0.130,
  "25251": -0.018,
  "25252": -0.089,
  "25253": -0.108,
  "25254": -0.164,
  "25255": -0.222,
  "25311": 0.216,
  "25312": 0.145,
  "25313": 0.126,
  "25314": 0.071,
  "25315": 0.012,
  "25321": 0.127,
  "25322": 0.055,
  "25323": 0.037,
  "25324": -0.019,
  "25325": -0.077,
  "25331": 0.104,
  "25332": 0.033,
  "25333": 0.014,
  "25334": -0.041,
  "25335": -0.100,
  "25341": 0.043,
  "25342": -0.028,
  "25343": -0.047,
  "25344": -0.103,
  "25345": -0.161,
  "25351": -0.049,
  "25352": -0.120,
  "25353": -0.139,
  "25354": -0.194,
  "25355": -0.253,
  "25411": 0.206,
  "25412": 0.134,
  "25413": 0.116,
  "25414": 0.060,
  "25415": 0.002,
  "25421": 0.116,
  "25422": 0.045,
  "25423": 0.026,
  "25424": -0.030,
  "25425": -0.088,
  "25431": 0.094,
  "25432": 0.022,
  "25433": 0.004,
  "25434": -0.052,
  "25435": -0.110,
  "25441": 0.033,
  "25442": -0.039,
  "25443": -0.057,
  "25444": -0.113,
  "25445": -0.171,
  "25451": -0.059,
  "25452": -0.131,
  "25453": -0.149,
  "25454": -0.205,
  "25455": -0.263,
  "25511": 0.183,
  "25512": 0.112,
  "25513": 0.093,
  "25514": 0.038,
  "25515": -0.021,
  "25521": 0.094,
  "25522": 0.022,
  "25523": 0.004,
  "25524": -0.052,
  "25525": -0.110,
  "25531": 0.071,
  "25532": 0.000,
  "25533": -0.019,
  "25534": -0.074,
  "25535": -0.133,
  "25541": 0.010,
  "25542": -0.061,
  "25543": -0.080,
  "25544": -0.136,
  "25545": -0.194,
  "25551": -0.082,
  "25552": -0.153,
  "25553": -0.172,
  "25554": -0.227,
  "25555": -0.286,
  "31111": 0.845,
  "31112": 0.774,
  "31113": 0.755,
  "31114": 0.614,
  "31115": 0.467,
  "31121": 0.755,
  "31122": 0.684,
  "31123": 0.665,
  "31124": 0.524,
  "31125": 0.377,
  "31131": 0.733,
  "31132": 0.662,
  "31133": 0.643,
  "31134": 0.502,
  "31135": 0.355,
  "31141": 0.602,
  "31142": 0.531,
  "31143": 0.512,
  "31144": 0.405,
  "31145": 0.294,
  "31151": 0.406,
  "31152": 0.335,
  "31153": 0.316,
  "31154": 0.260,
  "31155": 0.202,
  "31211": 0.720,
  "31212": 0.648,
  "31213": 0.630,
  "31214": 0.489,
  "31215": 0.342,
  "31221": 0.630,
  "31222": 0.559,
  "31223": 0.540,
  "31224": 0.399,
  "31225": 0.252,
  "31231": 0.608,
  "31232": 0.536,
  "31233": 0.518,
  "31234": 0.377,
  "31235": 0.230,
  "31241": 0.477,
  "31242": 0.406,
  "31243": 0.387,
  "31244": 0.280,
  "31245": 0.169,
  "31251": 0.281,
  "31252": 0.209,
  "31253": 0.191,
  "31254": 0.135,
  "31255": 0.077,
  "31311": 0.689,
  "31312": 0.618,
  "31313": 0.599,
  "31314": 0.458,
  "31315": 0.311,
  "31321": 0.599,
  "31322": 0.528,
  "31323": 0.509,
  "31324": 0.368,
  "31325": 0.221,
  "31331": 0.577,
  "31332": 0.506,
  "31333": 0.487,
  "31334": 0.346,
  "31335": 0.199,
  "31341": 0.446,
  "31342": 0.375,
  "31343": 0.356,
  "31344": 0.249,
  "31345": 0.138,
  "31351": 0.250,
  "31352": 0.179,
  "31353": 0.160,
  "31354": 0.104,
  "31355": 0.046,
  "31411": 0.621,
  "31412": 0.550,
  "31413": 0.531,
  "31414": 0.418,
  "31415": 0.300,
  "31421": 0.531,
  "31422": 0.460,
  "31423": 0.441,
  "31424": 0.328,
  "31425": 0.210,
  "31431": 0.509,
  "31432": 0.438,
  "31433": 0.419,
  "31434": 0.306,
  "31435": 0.188,
  "31441": 0.401,
  "31442": 0.330,
  "31443": 0.311,
  "31444": 0.221,
  "31445": 0.127,
  "31451": 0.239,
  "31452": 0.168,
  "31453": 0.149,
  "31454": 0.093,
  "31455": 0.035,
  "31511": 0.482,
  "31512": 0.411,
  "31513": 0.392,
  "31514": 0.336,
  "31515": 0.278,
  "31521": 0.392,
  "31522": 0.321,
  "31523": 0.302,
  "31524": 0.246,
  "31525": 0.188,
  "31531": 0.370,
  "31532": 0.299,
  "31533": 0.280,
  "31534": 0.224,
  "31535": 0.166,
  "31541": 0.309,
  "31542": 0.237,
  "31543": 0.219,
  "31544": 0.163,
  "31545": 0.105,
  "31551": 0.217,
  "31552": 0.146,
  "31553": 0.127,
  "31554": 0.071,
  "31555": 0.013,
  "32111": 0.668,
  "32112": 0.597,
  "32113": 0.578,
  "32114": 0.437,
  "32115": 0.290,
  "32121": 0.579,
  "32122": 0.507,
  "32123": 0.489,
  "32124": 0.347,
  "32125": 0.201,
  "32131": 0.556,
  "32132": 0.485,
  "32133": 0.466,
  "32134": 0.325,
  "32135": 0.178,
  "32141": 0.426,
  "32142": 0.354,
  "32143": 0.336,
  "32144": 0.229,
  "32145": 0.117,
  "32151": 0.229,
  "32152": 0.158,
  "32153": 0.139,
  "32154": 0.084,
  "32155": 0.025,
  "32211": 0.543,
  "32212": 0.472,
  "32213": 0.453,
  "32214": 0.312,
  "32215": 0.165,
  "32221": 0.454,
  "32222": 0.382,
  "32223": 0.364,
  "32224": 0.222,
  "32225": 0.076,
  "32231": 0.431,
  "32232": 0.360,
  "32233": 0.341,
  "32234": 0.200,
  "32235": 0.053,
  "32241": 0.301,
  "32242": 0.229,
  "32243": 0.211,
  "32244": 0.103,
  "32245": -0.008,
  "32251": 0.104,
  "32252": 0.033,
  "32253": 0.014,
  "32254": -0.042,
  "32255": -0.100,
  "32311": 0.512,
  "32312": 0.441,
  "32313": 0.422,
  "32314": 0.281,
  "32315": 0.134,
  "32321": 0.423,
  "32322": 0.351,
  "32323": 0.333,
  "32324": 0.191,
  "32325": 0.045,
  "32331": 0.400,
  "32332": 0.329,
  "32333": 0.310,
  "32334": 0.169,
  "32335": 0.022,
  "32341": 0.270,
  "32342": 0.198,
  "32343": 0.180,
  "32344": 0.073,
  "32345": -0.039,
  "32351": 0.073,
  "32352": 0.002,
  "32353": -0.017,
  "32354": -0.072,
  "32355": -0.131,
  "32411": 0.444,
  "32412": 0.373,
  "32413": 0.354,
  "32414": 0.241,
  "32415": 0.124,
  "32421": 0.355,
  "32422": 0.283,
  "32423": 0.265,
  "32424": 0.151,
  "32425": 0.034,
  "32431": 0.332,
  "32432": 0.261,
  "32433": 0.242,
  "32434": 0.129,
  "32435": 0.012,
  "32441": 0.225,
  "32442": 0.153,
  "32443": 0.135,
  "32444": 0.044,
  "32445": -0.049,
  "32451": 0.063,
  "32452": -0.009,
  "32453": -0.027,
  "32454": -0.083,
  "32455": -0.141,
  "32511": 0.305,
  "32512": 0.234,
  "32513": 0.215,
  "32514": 0.160,
  "32515": 0.101,
  "32521": 0.216,
  "32522": 0.144,
  "32523": 0.126,
  "32524": 0.070,
  "32525": 0.012,
  "32531": 0.193,
  "32532": 0.122,
  "32533": 0.103,
  "32534": 0.048,
  "32535": -0.011,
  "32541": 0.132,
  "32542": 0.061,
  "32543": 0.042,
  "32544": -0.014,
  "32545": -0.072,
  "32551": 0.040,
  "32552": -0.031,
  "32553": -0.050,
  "32554": -0.105,
  "32555": -0.164,
  "33111": 0.633,
  "33112": 0.562,
  "33113": 0.543,
  "33114": 0.402,
  "33115": 0.255,
  "33121": 0.543,
  "33122": 0.472,
  "33123": 0.453,
  "33124": 0.312,
  "33125": 0.165,
  "33131": 0.521,
  "33132": 0.450,
  "33133": 0.431,
  "33134": 0.290,
  "33135": 0.143,
  "33141": 0.390,
  "33142": 0.319,
  "33143": 0.300,
  "33144": 0.193,
  "33145": 0.082,
  "33151": 0.194,
  "33152": 0.123,
  "33153": 0.104,
  "33154": 0.048,
  "33155": -0.010,
  "33211": 0.508,
  "33212": 0.436,
  "33213": 0.418,
  "33214": 0.277,
  "33215": 0.130,
  "33221": 0.418,
  "33222": 0.347,
  "33223": 0.328,
  "33224": 0.187,
  "33225": 0.040,
  "33231": 0.396,
  "33232": 0.324,
  "33233": 0.306,
  "33234": 0.165,
  "33235": 0.018,
  "33241": 0.265,
  "33242": 0.194,
  "33243": 0.175,
  "33244": 0.068,
  "33245": -0.043,
  "33251": 0.069,
  "33252": -0.003,
  "33253": -0.021,
  "33254": -0.077,
  "33255": -0.135,
  "33311": 0.477,
  "33312": 0.406,
  "33313": 0.387,
  "33314": 0.246,
  "33315": 0.099,
  "33321": 0.387,
  "33322": 0.316,
  "33323": 0.297,
  "33324": 0.156,
  "33325": 0.009,
  "33331": 0.365,
  "33332": 0.294,
  "33333": 0.275,
  "33334": 0.134,
  "33335": -0.013,
  "33341": 0.234,
  "33342": 0.163,
  "33343": 0.144,
  "33344": 0.037,
  "33345": -0.074,
  "33351": 0.038,
  "33352": -0.033,
  "33353": -0.052,
  "33354": -0.108,
  "33355": -0.166,
  "33411": 0.409,
  "33412": 0.338,
  "33413": 0.319,
  "33414": 0.206,
  "33415": 0.088,
  "33421": 0.319,
  "33422": 0.248,
  "33423": 0.229,
  "33424": 0.116,
  "33425": -0.002,
  "33431": 0.297,
  "33432": 0.226,
  "33433": 0.207,
  "33434": 0.094,
  "33435": -0.024,
  "33441": 0.189,
  "33442": 0.118,
  "33443": 0.099,
  "33444": 0.009,
  "33445": -0.085,
  "33451": 0.027,
  "33452": -0.044,
  "33453": -0.063,
  "33454": -0.119,
  "33455": -0.177,
  "33511": 0.270,
  "33512": 0.199,
  "33513": 0.180,
  "33514": 0.124,
  "33515": 0.066,
  "33521": 0.180,
  "33522": 0.109,
  "33523": 0.090,
  "33524": 0.034,
  "33525": -0.024,
  "33531": 0.158,
  "33532": 0.087,
  "33533": 0.068,
  "33534": 0.012,
  "33535": -0.046,
  "33541": 0.097,
  "33542": 0.025,
  "33543": 0.007,
  "33544": -0.049,
  "33545": -0.107,
  "33551": 0.005,
  "33552": -0.066,
  "33553": -0.085,
  "33554": -0.141,
  "33555": -0.199,
  "34111": 0.563,
  "34112": 0.492,
  "34113": 0.473,
  "34114": 0.352,
  "34115": 0.227,
  "34121": 0.473,
  "34122": 0.402,
  "34123": 0.383,
  "34124": 0.263,
  "34125": 0.138,
  "34131": 0.451,
  "34132": 0.380,
  "34133": 0.361,
  "34134": 0.240,
  "34135": 0.115,
  "34141": 0.337,
  "34142": 0.266,
  "34143": 0.247,
  "34144": 0.153,
  "34145": 0.054,
  "34151": 0.166,
  "34152": 0.095,
  "34153": 0.076,
  "34154": 0.020,
  "34155": -0.038,
  "34211": 0.438,
  "34212": 0.366,
  "34213": 0.348,
  "34214": 0.227,
  "34215": 0.102,
  "34221": 0.348,
  "34222": 0.277,
  "34223": 0.258,
  "34224": 0.138,
  "34225": 0.012,
  "34231": 0.326,
  "34232": 0.254,
  "34233": 0.236,
  "34234": 0.115,
  "34235": -0.010,
  "34241": 0.212,
  "34242": 0.141,
  "34243": 0.122,
  "34244": 0.027,
  "34245": -0.071,
  "34251": 0.041,
  "34252": -0.030,
  "34253": -0.049,
  "34254": -0.105,
  "34255": -0.163,
  "34311": 0.407,
  "34312": 0.336,
  "34313": 0.317,
  "34314": 0.196,
  "34315": 0.071,
  "34321": 0.317,
  "34322": 0.246,
  "34323": 0.227,
  "34324": 0.107,
  "34325": -0.018,
  "34331": 0.295,
  "34332": 0.224,
  "34333": 0.205,
  "34334": 0.084,
  "34335": -0.041,
  "34341": 0.181,
  "34342": 0.110,
  "34343": 0.091,
  "34344": -0.003,
  "34345": -0.102,
  "34351": 0.010,
  "34352": -0.061,
  "34353": -0.080,
  "34354": -0.136,
  "34355": -0.194,
  "34411": 0.353,
  "34412": 0.281,
  "34413": 0.263,
  "34414": 0.164,
  "34415": 0.060,
  "34421": 0.263,
  "34422": 0.192,
  "34423": 0.173,
  "34424": 0.074,
  "34425": -0.029,
  "34431": 0.241,
  "34432": 0.169,
  "34433": 0.151,
  "34434": 0.052,
  "34435": -0.052,
  "34441": 0.144,
  "34442": 0.073,
  "34443": 0.054,
  "34444": -0.028,
  "34445": -0.113,
  "34451": -0.001,
  "34452": -0.072,
  "34453": -0.091,
  "34454": -0.146,
  "34455": -0.205,
  "34511": 0.242,
  "34512": 0.171,
  "34513": 0.152,
  "34514": 0.096,
  "34515": 0.038,
  "34521": 0.153,
  "34522": 0.081,
  "34523": 0.063,
  "34524": 0.007,
  "34525": -0.051,
  "34531": 0.130,
  "34532": 0.059,
  "34533": 0.040,
  "34534": -0.016,
  "34535": -0.074,
  "34541": 0.069,
  "34542": -0.002,
  "34543": -0.021,
  "34544": -0.077,
  "34545": -0.135,
  "34551": -0.023,
  "34552": -0.094,
  "34553": -0.113,
  "34554": -0.169,
  "34555": -0.227,
  "35111": 0.345,
  "35112": 0.274,
  "35113": 0.255,
  "35114": 0.199,
  "35115": 0.141,
  "35121": 0.255,
  "35122": 0.184,
  "35123": 0.165,
  "35124": 0.109,
  "35125": 0.051,
  "35131": 0.233,
  "35132": 0.162,
  "35133": 0.143,
  "35134": 0.087,
  "35135": 0.029,
  "35141": 0.172,
  "35142": 0.100,
  "35143": 0.082,
  "35144": 0.026,
  "35145": -0.032,
  "35151": 0.080,
  "35152": 0.009,
  "35153": -0.010,
  "35154": -0.066,
  "35155": -0.124,
  "35211": 0.220,
  "35212": 0.148,
  "35213": 0.130,
  "35214": 0.074,
  "35215": 0.016,
  "35221": 0.130,
  "35222": 0.059,
  "35223": 0.040,
  "35224": -0.016,
  "35225": -0.074,
  "35231": 0.108,
  "35232": 0.036,
  "35233": 0.018,
  "35234": -0.038,
  "35235": -0.096,
  "35241": 0.047,
  "35242": -0.025,
  "35243": -0.043,
  "35244": -0.099,
  "35245": -0.157,
  "35251": -0.045,
  "35252": -0.117,
  "35253": -0.135,
  "35254": -0.191,
  "35255": -0.249,
  "35311": 0.189,
  "35312": 0.118,
  "35313": 0.099,
  "35314": 0.043,
  "35315": -0.015,
  "35321": 0.099,
  "35322": 0.028,
  "35323": 0.009,
  "35324": -0.047,
  "35325": -0.105,
  "35331": 0.077,
  "35332": 0.006,
  "35333": -0.013,
  "35334": -0.069,
  "35335": -0.127,
  "35341": 0.016,
  "35342": -0.056,
  "35343": -0.074,
  "35344": -0.130,
  "35345": -0.188,
  "35351": -0.076,
  "35352": -0.147,
  "35353": -0.166,
  "35354": -0.222,
  "35355": -0.280,
  "35411": 0.178,
  "35412": 0.107,
  "35413": 0.088,
  "35414": 0.032,
  "35415": -0.026,
  "35421": 0.088,
  "35422": 0.017,
  "35423": -0.002,
  "35424": -0.058,
  "35425": -0.116,
  "35431": 0.066,
  "35432": -0.005,
  "35433": -0.024,
  "35434": -0.080,
  "35435": -0.138,
  "35441": 0.005,
  "35442": -0.066,
  "35443": -0.085,
  "35444": -0.141,
  "35445": -0.199,
  "35451": -0.087,
  "35452": -0.158,
  "35453": -0.177,
  "35454": -0.233,
  "35455": -0.291,
  "35511": 0.156,
  "35512": 0.085,
  "35513": 0.066,
  "35514": 0.010,
  "35515": -0.048,
  "35521": 0.066,
  "35522": -0.005,
  "35523": -0.024,
  "35524": -0.080,
  "35525": -0.138,
  "35531": 0.044,
  "35532": -0.027,
  "35533": -0.046,
  "35534": -0.102,
  "35535": -0.160,
  "35541": -0.017,
  "35542": -0.089,
  "35543": -0.107,
  "35544": -0.163,
  "35545": -0.221,
  "35551": -0.109,
  "35552": -0.180,
  "35553": -0.199,
  "35554": -0.255,
  "35555": -0.313,
  "41111": 0.817,
  "41112": 0.745,
  "41113": 0.727,
  "41114": 0.592,
  "41115": 0.451,
  "41121": 0.727,
  "41122": 0.656,
  "41123": 0.637,
  "41124": 0.502,
  "41125": 0.362,
  "41131": 0.705,
  "41132": 0.633,
  "41133": 0.615,
  "41134": 0.480,
  "41135": 0.339,
  "41141": 0.579,
  "41142": 0.508,
  "41143": 0.489,
  "41144": 0.386,
  "41145": 0.278,
  "41151": 0.390,
  "41152": 0.319,
  "41153": 0.300,
  "41154": 0.244,
  "41155": 0.186,
  "41211": 0.692,
  "41212": 0.620,
  "41213": 0.602,
  "41214": 0.467,
  "41215": 0.326,
  "41221": 0.602,
  "41222": 0.531,
  "41223": 0.512,
  "41224": 0.377,
  "41225": 0.236,
  "41231": 0.580,
  "41232": 0.508,
  "41233": 0.490,
  "41234": 0.355,
  "41235": 0.214,
  "41241": 0.454,
  "41242": 0.383,
  "41243": 0.364,
  "41244": 0.261,
  "41245": 0.153,
  "41251": 0.265,
  "41252": 0.194,
  "41253": 0.175,
  "41254": 0.119,
  "41255": 0.061,
  "41311": 0.661,
  "41312": 0.589,
  "41313": 0.571,
  "41314": 0.436,
  "41315": 0.295,
  "41321": 0.571,
  "41322": 0.500,
  "41323": 0.481,
  "41324": 0.346,
  "41325": 0.206,
  "41331": 0.549,
  "41332": 0.477,
  "41333": 0.459,
  "41334": 0.324,
  "41335": 0.183,
  "41341": 0.423,
  "41342": 0.352,
  "41343": 0.333,
  "41344": 0.230,
  "41345": 0.122,
  "41351": 0.234,
  "41352": 0.163,
  "41353": 0.144,
  "41354": 0.088,
  "41355": 0.030,
  "41411": 0.597,
  "41412": 0.526,
  "41413": 0.507,
  "41414": 0.398,
  "41415": 0.285,
  "41421": 0.507,
  "41422": 0.436,
  "41423": 0.417,
  "41424": 0.308,
  "41425": 0.195,
  "41431": 0.485,
  "41432": 0.414,
  "41433": 0.395,
  "41434": 0.286,
  "41435": 0.173,
  "41441": 0.380,
  "41442": 0.309,
  "41443": 0.290,
  "41444": 0.203,
  "41445": 0.111,
  "41451": 0.224,
  "41452": 0.152,
  "41453": 0.134,
  "41454": 0.078,
  "41455": 0.020,
  "41511": 0.466,
  "41512": 0.395,
  "41513": 0.376,
  "41514": 0.320,
  "41515": 0.262,
  "41521": 0.377,
  "41522": 0.305,
  "41523": 0.287,
  "41524": 0.231,
  "41525": 0.173,
  "41531": 0.354,
  "41532": 0.283,
  "41533": 0.264,
  "41534": 0.208,
  "41535": 0.150,
  "41541": 0.293,
  "41542": 0.222,
  "41543": 0.203,
  "41544": 0.147,
  "41545": 0.089,
  "41551": 0.201,
  "41552": 0.130,
  "41553": 0.111,
  "41554": 0.055,
  "41555": -0.003,
  "42111": 0.640,
  "42112": 0.569,
  "42113": 0.550,
  "42114": 0.415,
  "42115": 0.275,
  "42121": 0.551,
  "42122": 0.479,
  "42123": 0.461,
  "42124": 0.325,
  "42125": 0.185,
  "42131": 0.528,
  "42132": 0.457,
  "42133": 0.438,
  "42134": 0.303,
  "42135": 0.163,
  "42141": 0.403,
  "42142": 0.331,
  "42143": 0.313,
  "42144": 0.209,
  "42145": 0.102,
  "42151": 0.214,
  "42152": 0.142,
  "42153": 0.124,
  "42154": 0.068,
  "42155": 0.010,
  "42211": 0.515,
  "42212": 0.444,
  "42213": 0.425,
  "42214": 0.290,
  "42215": 0.150,
  "42221": 0.425,
  "42222": 0.354,
  "42223": 0.335,
  "42224": 0.200,
  "42225": 0.060,
  "42231": 0.403,
  "42232": 0.332,
  "42233": 0.313,
  "42234": 0.178,
  "42235": 0.038,
  "42241": 0.278,
  "42242": 0.206,
  "42243": 0.188,
  "42244": 0.084,
  "42245": -0.023,
  "42251": 0.089,
  "42252": 0.017,
  "42253": -0.001,
  "42254": -0.057,
  "42255": -0.115,
  "42311": 0.484,
  "42312": 0.413,
  "42313": 0.394,
  "42314": 0.259,
  "42315": 0.119,
  "42321": 0.395,
  "42322": 0.323,
  "42323": 0.305,
  "42324": 0.169,
  "42325": 0.029,
  "42331": 0.372,
  "42332": 0.301,
  "42333": 0.282,
  "42334": 0.147,
  "42335": 0.007,
  "42341": 0.247,
  "42342": 0.175,
  "42343": 0.157,
  "42344": 0.053,
  "42345": -0.054,
  "42351": 0.058,
  "42352": -0.014,
  "42353": -0.032,
  "42354": -0.088,
  "42355": -0.146,
  "42411": 0.420,
  "42412": 0.349,
  "42413": 0.330,
  "42414": 0.221,
  "42415": 0.108,
  "42421": 0.331,
  "42422": 0.259,
  "42423": 0.241,
  "42424": 0.132,
  "42425": 0.018,
  "42431": 0.308,
  "42432": 0.237,
  "42433": 0.218,
  "42434": 0.109,
  "42435": -0.004,
  "42441": 0.204,
  "42442": 0.133,
  "42443": 0.114,
  "42444": 0.026,
  "42445": -0.065,
  "42451": 0.047,
  "42452": -0.024,
  "42453": -0.043,
  "42454": -0.099,
  "42455": -0.157,
  "42511": 0.290,
  "42512": 0.218,
  "42513": 0.200,
  "42514": 0.144,
  "42515": 0.086,
  "42521": 0.200,
  "42522": 0.129,
  "42523": 0.110,
  "42524": 0.054,
  "42525": -0.004,
  "42531": 0.178,
  "42532": 0.106,
  "42533": 0.088,
  "42534": 0.032,
  "42535": -0.026,
  "42541": 0.117,
  "42542": 0.045,
  "42543": 0.027,
  "42544": -0.029,
  "42545": -0.087,
  "42551": 0.025,
  "42552": -0.047,
  "42553": -0.065,
  "42554": -0.121,
  "42555": -0.179,
  "43111": 0.605,
  "43112": 0.533,
  "43113": 0.515,
  "43114": 0.380,
  "43115": 0.239,
  "43121": 0.515,
  "43122": 0.444,
  "43123": 0.425,
  "43124": 0.290,
  "43125": 0.150,
  "43131": 0.493,
  "43132": 0.421,
  "43133": 0.403,
  "43134": 0.268,
  "43135": 0.127,
  "43141": 0.367,
  "43142": 0.296,
  "43143": 0.277,
  "43144": 0.174,
  "43145": 0.066,
  "43151": 0.178,
  "43152": 0.107,
  "43153": 0.088,
  "43154": 0.032,
  "43155": -0.026,
  "43211": 0.480,
  "43212": 0.408,
  "43213": 0.390,
  "43214": 0.255,
  "43215": 0.114,
  "43221": 0.390,
  "43222": 0.319,
  "43223": 0.300,
  "43224": 0.165,
  "43225": 0.024,
  "43231": 0.368,
  "43232": 0.296,
  "43233": 0.278,
  "43234": 0.143,
  "43235": 0.002,
  "43241": 0.242,
  "43242": 0.171,
  "43243": 0.152,
  "43244": 0.049,
  "43245": -0.059,
  "43251": 0.053,
  "43252": -0.018,
  "43253": -0.037,
  "43254": -0.093,
  "43255": -0.151,
  "43311": 0.449,
  "43312": 0.377,
  "43313": 0.359,
  "43314": 0.224,
  "43315": 0.083,
  "43321": 0.359,
  "43322": 0.288,
  "43323": 0.269,
  "43324": 0.134,
  "43325": -0.006,
  "43331": 0.337,
  "43332": 0.265,
  "43333": 0.247,
  "43334": 0.112,
  "43335": -0.029,
  "43341": 0.211,
  "43342": 0.140,
  "43343": 0.121,
  "43344": 0.018,
  "43345": -0.090,
  "43351": 0.022,
  "43352": -0.049,
  "43353": -0.068,
  "43354": -0.124,
  "43355": -0.182,
  "43411": 0.385,
  "43412": 0.314,
  "43413": 0.295,
  "43414": 0.186,
  "43415": 0.073,
  "43421": 0.295,
  "43422": 0.224,
  "43423": 0.205,
  "43424": 0.096,
  "43425": -0.017,
  "43431": 0.273,
  "43432": 0.202,
  "43433": 0.183,
  "43434": 0.074,
  "43435": -0.039,
  "43441": 0.168,
  "43442": 0.097,
  "43443": 0.078,
  "43444": -0.009,
  "43445": -0.101,
  "43451": 0.012,
  "43452": -0.060,
  "43453": -0.078,
  "43454": -0.134,
  "43455": -0.192,
  "43511": 0.254,
  "43512": 0.183,
  "43513": 0.164,
  "43514": 0.108,
  "43515": 0.050,
  "43521": 0.165,
  "43522": 0.093,
  "43523": 0.075,
  "43524": 0.019,
  "43525": -0.039,
  "43531": 0.142,
  "43532": 0.071,
  "43533": 0.052,
  "43534": -0.004,
  "43535": -0.062,
  "43541": 0.081,
  "43542": 0.010,
  "43543": -0.009,
  "43544": -0.065,
  "43545": -0.123,
  "43551": -0.011,
  "43552": -0.082,
  "43553": -0.101,
  "43554": -0.157,
  "43555": -0.215,
  "44111": 0.538,
  "44112": 0.466,
  "44113": 0.448,
  "44114": 0.332,
  "44115": 0.212,
  "44121": 0.448,
  "44122": 0.377,
  "44123": 0.358,
  "44124": 0.242,
  "44125": 0.122,
  "44131": 0.426,
  "44132": 0.354,
  "44133": 0.336,
  "44134": 0.220,
  "44135": 0.100,
  "44141": 0.316,
  "44142": 0.245,
  "44143": 0.226,
  "44144": 0.134,
  "44145": 0.039,
  "44151": 0.151,
  "44152": 0.079,
  "44153": 0.061,
  "44154": 0.005,
  "44155": -0.053,
  "44211": 0.413,
  "44212": 0.341,
  "44213": 0.323,
  "44214": 0.207,
  "44215": 0.087,
  "44221": 0.323,
  "44222": 0.252,
  "44223": 0.233,
  "44224": 0.117,
  "44225": -0.003,
  "44231": 0.301,
  "44232": 0.229,
  "44233": 0.211,
  "44234": 0.095,
  "44235": -0.025,
  "44241": 0.191,
  "44242": 0.119,
  "44243": 0.101,
  "44244": 0.009,
  "44245": -0.087,
  "44251": 0.026,
  "44252": -0.046,
  "44253": -0.064,
  "44254": -0.120,
  "44255": -0.178,
  "44311": 0.382,
  "44312": 0.310,
  "44313": 0.292,
  "44314": 0.176,
  "44315": 0.056,
  "44321": 0.292,
  "44322": 0.221,
  "44323": 0.202,
  "44324": 0.086,
  "44325": -0.034,
  "44331": 0.270,
  "44332": 0.198,
  "44333": 0.180,
  "44334": 0.064,
  "44335": -0.056,
  "44341": 0.160,
  "44342": 0.089,
  "44343": 0.070,
  "44344": -0.022,
  "44345": -0.117,
  "44351": -0.005,
  "44352": -0.077,
  "44353": -0.095,
  "44354": -0.151,
  "44355": -0.209,
  "44411": 0.331,
  "44412": 0.259,
  "44413": 0.241,
  "44414": 0.145,
  "44415": 0.045,
  "44421": 0.241,
  "44422": 0.170,
  "44423": 0.151,
  "44424": 0.055,
  "44425": -0.045,
  "44431": 0.219,
  "44432": 0.147,
  "44433": 0.129,
  "44434": 0.033,
  "44435": -0.067,
  "44441": 0.125,
  "44442": 0.054,
  "44443": 0.035,
  "44444": -0.045,
  "44445": -0.128,
  "44451": -0.016,
  "44452": -0.088,
  "44453": -0.106,
  "44454": -0.162,
  "44455": -0.220,
  "44511": 0.227,
  "44512": 0.155,
  "44513": 0.137,
  "44514": 0.081,
  "44515": 0.023,
  "44521": 0.137,
  "44522": 0.066,
  "44523": 0.047,
  "44524": -0.009,
  "44525": -0.067,
  "44531": 0.115,
  "44532": 0.043,
  "44533": 0.025,
  "44534": -0.031,
  "44535": -0.089,
  "44541": 0.054,
  "44542": -0.018,
  "44543": -0.036,
  "44544": -0.092,
  "44545": -0.150,
  "44551": -0.038,
  "44552": -0.110,
  "44553": -0.128,
  "44554": -0.184,
  "44555": -0.242,
  "45111": 0.329,
  "45112": 0.258,
  "45113": 0.239,
  "45114": 0.183,
  "45115": 0.125,
  "45121": 0.240,
  "45122": 0.168,
  "45123": 0.150,
  "45124": 0.094,
  "45125": 0.036,
  "45131": 0.217,
  "45132": 0.146,
  "45133": 0.127,
  "45134": 0.071,
  "45135": 0.013,
  "45141": 0.156,
  "45142": 0.085,
  "45143": 0.066,
  "45144": 0.010,
  "45145": -0.048,
  "45151": 0.064,
  "45152": -0.007,
  "45153": -0.026,
  "45154": -0.082,
  "45155": -0.140,
  "45211": 0.204,
  "45212": 0.133,
  "45213": 0.114,
  "45214": 0.058,
  "45215": 0.000,
  "45221": 0.114,
  "45222": 0.043,
  "45223": 0.024,
  "45224": -0.031,
  "45225": -0.090,
  "45231": 0.092,
  "45232": 0.021,
  "45233": 0.002,
  "45234": -0.054,
  "45235": -0.112,
  "45241": 0.031,
  "45242": -0.040,
  "45243": -0.059,
  "45244": -0.115,
  "45245": -0.173,
  "45251": -0.061,
  "45252": -0.132,
  "45253": -0.151,
  "45254": -0.207,
  "45255": -0.265,
  "45311": 0.173,
  "45312": 0.102,
  "45313": 0.083,
  "45314": 0.027,
  "45315": -0.031,
  "45321": 0.084,
  "45322": 0.012,
  "45323": -0.006,
  "45324": -0.062,
  "45325": -0.120,
  "45331": 0.061,
  "45332": -0.010,
  "45333": -0.029,
  "45334": -0.085,
  "45335": -0.143,
  "45341": 0.000,
  "45342": -0.071,
  "45343": -0.090,
  "45344": -0.146,
  "45345": -0.204,
  "45351": -0.092,
  "45352": -0.163,
  "45353": -0.182,
  "45354": -0.238,
  "45355": -0.296,
  "45411": 0.163,
  "45412": 0.091,
  "45413": 0.073,
  "45414": 0.017,
  "45415": -0.041,
  "45421": 0.073,
  "45422": 0.001,
  "45423": -0.017,
  "45424": -0.073,
  "45425": -0.131,
  "45431": 0.051,
  "45432": -0.021,
  "45433": -0.039,
  "45434": -0.095,
  "45435": -0.153,
  "45441": -0.011,
  "45442": -0.082,
  "45443": -0.101,
  "45444": -0.157,
  "45445": -0.215,
  "45451": -0.102,
  "45452": -0.174,
  "45453": -0.192,
  "45454": -0.248,
  "45455": -0.306,
  "45511": 0.140,
  "45512": 0.069,
  "45513": 0.050,
  "45514": -0.006,
  "45515": -0.064,
  "45521": 0.051,
  "45522": -0.021,
  "45523": -0.039,
  "45524": -0.095,
  "45525": -0.153,
  "45531": 0.028,
  "45532": -0.043,
  "45533": -0.062,
  "45534": -0.118,
  "45535": -0.176,
  "45541": -0.033,
  "45542": -0.104,
  "45543": -0.123,
  "45544": -0.179,
  "45545": -0.237,
  "45551": -0.125,
  "45552": -0.196,
  "45553": -0.215,
  "45554": -0.271,
  "45555": -0.329,
  "51111": 0.454,
  "51112": 0.383,
  "51113": 0.364,
  "51114": 0.308,
  "51115": 0.250,
  "51121": 0.364,
  "51122": 0.293,
  "51123": 0.274,
  "51124": 0.218,
  "51125": 0.160,
  "51131": 0.342,
  "51132": 0.271,
  "51133": 0.252,
  "51134": 0.196,
  "51135": 0.138,
  "51141": 0.281,
  "51142": 0.209,
  "51143": 0.191,
  "51144": 0.135,
  "51145": 0.077,
  "51151": 0.189,
  "51152": 0.118,
  "51153": 0.099,
  "51154": 0.043,
  "51155": -0.015,
  "51211": 0.329,
  "51212": 0.257,
  "51213": 0.239,
  "51214": 0.183,
  "51215": 0.125,
  "51221": 0.239,
  "51222": 0.168,
  "51223": 0.149,
  "51224": 0.093,
  "51225": 0.035,
  "51231": 0.217,
  "51232": 0.145,
  "51233": 0.127,
  "51234": 0.071,
  "51235": 0.013,
  "51241": 0.156,
  "51242": 0.084,
  "51243": 0.066,
  "51244": 0.010,
  "51245": -0.048,
  "51251": 0.064,
  "51252": -0.008,
  "51253": -0.026,
  "51254": -0.082,
  "51255": -0.140,
  "51311": 0.298,
  "51312": 0.227,
  "51313": 0.208,
  "51314": 0.152,
  "51315": 0.094,
  "51321": 0.208,
  "51322": 0.137,
  "51323": 0.118,
  "51324": 0.062,
  "51325": 0.004,
  "51331": 0.186,
  "51332": 0.115,
  "51333": 0.096,
  "51334": 0.040,
  "51335": -0.018,
  "51341": 0.125,
  "51342": 0.053,
  "51343": 0.035,
  "51344": -0.021,
  "51345": -0.079,
  "51351": 0.033,
  "51352": -0.038,
  "51353": -0.057,
  "51354": -0.113,
  "51355": -0.171,
  "51411": 0.287,
  "51412": 0.216,
  "51413": 0.197,
  "51414": 0.141,
  "51415": 0.083,
  "51421": 0.197,
  "51422": 0.126,
  "51423": 0.107,
  "51424": 0.051,
  "51425": -0.007,
  "51431": 0.175,
  "51432": 0.104,
  "51433": 0.085,
  "51434": 0.029,
  "51435": -0.029,
  "51441": 0.114,
  "51442": 0.043,
  "51443": 0.024,
  "51444": -0.032,
  "51445": -0.090,
  "51451": 0.022,
  "51452": -0.049,
  "51453": -0.068,
  "51454": -0.124,
  "51455": -0.182,
  "51511": 0.265,
  "51512": 0.194,
  "51513": 0.175,
  "51514": 0.119,
  "51515": 0.061,
  "51521": 0.175,
  "51522": 0.104,
  "51523": 0.085,
  "51524": 0.029,
  "51525": -0.029,
  "51531": 0.153,
  "51532": 0.082,
  "51533": 0.063,
  "51534": 0.007,
  "51535": -0.051,
  "51541": 0.092,
  "51542": 0.020,
  "51543": 0.002,
  "51544": -0.054,
  "51545": -0.112,
  "51551": 0.000,
  "51552": -0.071,
  "51553": -0.090,
  "51554": -0.146,
  "51555": -0.204,
  "52111": 0.277,
  "52112": 0.206,
  "52113": 0.187,
  "52114": 0.132,
  "52115": 0.073,
  "52121": 0.188,
  "52122": 0.116,
  "52123": 0.098,
  "52124": 0.042,
  "52125": -0.016,
  "52131": 0.165,
  "52132": 0.094,
  "52133": 0.075,
  "52134": 0.020,
  "52135": -0.039,
  "52141": 0.104,
  "52142": 0.033,
  "52143": 0.014,
  "52144": -0.042,
  "52145": -0.100,
  "52151": 0.012,
  "52152": -0.059,
  "52153": -0.078,
  "52154": -0.133,
  "52155": -0.192,
  "52211": 0.152,
  "52212": 0.081,
  "52213": 0.062,
  "52214": 0.006,
  "52215": -0.052,
  "52221": 0.063,
  "52222": -0.009,
  "52223": -0.027,
  "52224": -0.083,
  "52225": -0.141,
  "52231": 0.040,
  "52232": -0.031,
  "52233": -0.050,
  "52234": -0.106,
  "52235": -0.164,
  "52241": -0.021,
  "52242": -0.092,
  "52243": -0.111,
  "52244": -0.167,
  "52245": -0.225,
  "52251": -0.113,
  "52252": -0.184,
  "52253": -0.203,
  "52254": -0.259,
  "52255": -0.317,
  "52311": 0.121,
  "52312": 0.050,
  "52313": 0.031,
  "52314": -0.024,
  "52315": -0.083,
  "52321": 0.032,
  "52322": -0.040,
  "52323": -0.058,
  "52324": -0.114,
  "52325": -0.172,
  "52331": 0.009,
  "52332": -0.062,
  "52333": -0.081,
  "52334": -0.136,
  "52335": -0.195,
  "52341": -0.052,
  "52342": -0.123,
  "52343": -0.142,
  "52344": -0.198,
  "52345": -0.256,
  "52351": -0.144,
  "52352": -0.215,
  "52353": -0.234,
  "52354": -0.289,
  "52355": -0.348,
  "52411": 0.111,
  "52412": 0.039,
  "52413": 0.021,
  "52414": -0.035,
  "52415": -0.093,
  "52421": 0.021,
  "52422": -0.050,
  "52423": -0.069,
  "52424": -0.125,
  "52425": -0.183,
  "52431": -0.001,
  "52432": -0.073,
  "52433": -0.091,
  "52434": -0.147,
  "52435": -0.205,
  "52441": -0.062,
  "52442": -0.134,
  "52443": -0.152,
  "52444": -0.208,
  "52445": -0.266,
  "52451": -0.154,
  "52452": -0.226,
  "52453": -0.244,
  "52454": -0.300,
  "52455": -0.358,
  "52511": 0.088,
  "52512": 0.017,
  "52513": -0.002,
  "52514": -0.057,
  "52515": -0.116,
  "52521": -0.001,
  "52522": -0.073,
  "52523": -0.091,
  "52524": -0.147,
  "52525": -0.205,
  "52531": -0.024,
  "52532": -0.095,
  "52533": -0.114,
  "52534": -0.169,
  "52535": -0.228,
  "52541": -0.085,
  "52542": -0.156,
  "52543": -0.175,
  "52544": -0.231,
  "52545": -0.289,
  "52551": -0.177,
  "52552": -0.248,
  "52553": -0.267,
  "52554": -0.322,
  "52555": -0.381,
  "53111": 0.242,
  "53112": 0.171,
  "53113": 0.152,
  "53114": 0.096,
  "53115": 0.038,
  "53121": 0.152,
  "53122": 0.081,
  "53123": 0.062,
  "53124": 0.006,
  "53125": -0.052,
  "53131": 0.130,
  "53132": 0.059,
  "53133": 0.040,
  "53134": -0.016,
  "53135": -0.074,
  "53141": 0.069,
  "53142": -0.003,
  "53143": -0.021,
  "53144": -0.077,
  "53145": -0.135,
  "53151": -0.023,
  "53152": -0.094,
  "53153": -0.113,
  "53154": -0.169,
  "53155": -0.227,
  "53211": 0.117,
  "53212": 0.045,
  "53213": 0.027,
  "53214": -0.029,
  "53215": -0.087,
  "53221": 0.027,
  "53222": -0.044,
  "53223": -0.063,
  "53224": -0.119,
  "53225": -0.177,
  "53231": 0.005,
  "53232": -0.067,
  "53233": -0.085,
  "53234": -0.141,
  "53235": -0.199,
  "53241": -0.056,
  "53242": -0.128,
  "53243": -0.146,
  "53244": -0.202,
  "53245": -0.260,
  "53251": -0.148,
  "53252": -0.220,
  "53253": -0.238,
  "53254": -0.294,
  "53255": -0.352,
  "53311": 0.086,
  "53312": 0.015,
  "53313": -0.004,
  "53314": -0.060,
  "53315": -0.118,
  "53321": -0.004,
  "53322": -0.075,
  "53323": -0.094,
  "53324": -0.150,
  "53325": -0.208,
  "53331": -0.026,
  "53332": -0.097,
  "53333": -0.116,
  "53334": -0.172,
  "53335": -0.230,
  "53341": -0.087,
  "53342": -0.159,
  "53343": -0.177,
  "53344": -0.233,
  "53345": -0.291,
  "53351": -0.179,
  "53352": -0.250,
  "53353": -0.269,
  "53354": -0.325,
  "53355": -0.383,
  "53411": 0.075,
  "53412": 0.004,
  "53413": -0.015,
  "53414": -0.071,
  "53415": -0.129,
  "53421": -0.015,
  "53422": -0.086,
  "53423": -0.105,
  "53424": -0.161,
  "53425": -0.219,
  "53431": -0.037,
  "53432": -0.108,
  "53433": -0.127,
  "53434": -0.183,
  "53435": -0.241,
  "53441": -0.098,
  "53442": -0.169,
  "53443": -0.188,
  "53444": -0.244,
  "53445": -0.302,
  "53451": -0.190,
  "53452": -0.261,
  "53453": -0.280,
  "53454": -0.336,
  "53455": -0.394,
  "53511": 0.053,
  "53512": -0.018,
  "53513": -0.037,
  "53514": -0.093,
  "53515": -0.151,
  "53521": -0.037,
  "53522": -0.108,
  "53523": -0.127,
  "53524": -0.183,
  "53525": -0.241,
  "53531": -0.059,
  "53532": -0.130,
  "53533": -0.149,
  "53534": -0.205,
  "53535": -0.263,
  "53541": -0.120,
  "53542": -0.192,
  "53543": -0.210,
  "53544": -0.266,
  "53545": -0.324,
  "53551": -0.212,
  "53552": -0.283,
  "53553": -0.302,
  "53554": -0.358,
  "53555": -0.416,
  "54111": 0.214,
  "54112": 0.143,
  "54113": 0.124,
  "54114": 0.068,
  "54115": 0.010,
  "54121": 0.125,
  "54122": 0.053,
  "54123": 0.035,
  "54124": -0.021,
  "54125": -0.079,
  "54131": 0.102,
  "54132": 0.031,
  "54133": 0.012,
  "54134": -0.044,
  "54135": -0.102,
  "54141": 0.041,
  "54142": -0.030,
  "54143": -0.049,
  "54144": -0.105,
  "54145": -0.163,
  "54151": -0.051,
  "54152": -0.122,
  "54153": -0.141,
  "54154": -0.197,
  "54155": -0.255,
  "54211": 0.089,
  "54212": 0.018,
  "54213": -0.001,
  "54214": -0.057,
  "54215": -0.115,
  "54221": -0.001,
  "54222": -0.072,
  "54223": -0.091,
  "54224": -0.147,
  "54225": -0.205,
  "54231": -0.023,
  "54232": -0.094,
  "54233": -0.113,
  "54234": -0.169,
  "54235": -0.227,
  "54241": -0.084,
  "54242": -0.155,
  "54243": -0.174,
  "54244": -0.230,
  "54245": -0.288,
  "54251": -0.176,
  "54252": -0.247,
  "54253": -0.266,
  "54254": -0.322,
  "54255": -0.380,
  "54311": 0.058,
  "54312": -0.013,
  "54313": -0.032,
  "54314": -0.088,
  "54315": -0.146,
  "54321": -0.031,
  "54322": -0.103,
  "54323": -0.121,
  "54324": -0.177,
  "54325": -0.235,
  "54331": -0.054,
  "54332": -0.125,
  "54333": -0.144,
  "54334": -0.200,
  "54335": -0.258,
  "54341": -0.115,
  "54342": -0.186,
  "54343": -0.205,
  "54344": -0.261,
  "54345": -0.319,
  "54351": -0.207,
  "54352": -0.278,
  "54353": -0.297,
  "54354": -0.353,
  "54355": -0.411,
  "54411": 0.047,
  "54412": -0.024,
  "54413": -0.043,
  "54414": -0.098,
  "54415": -0.157,
  "54421": -0.042,
  "54422": -0.114,
  "54423": -0.132,
  "54424": -0.188,
  "54425": -0.246,
  "54431": -0.065,
  "54432": -0.136,
  "54433": -0.155,
  "54434": -0.210,
  "54435": -0.269,
  "54441": -0.126,
  "54442": -0.197,
  "54443": -0.216,
  "54444": -0.272,
  "54445": -0.330,
  "54451": -0.218,
  "54452": -0.289,
  "54453": -0.308,
  "54454": -0.363,
  "54455": -0.422,
  "54511": 0.025,
  "54512": -0.046,
  "54513": -0.065,
  "54514": -0.121,
  "54515": -0.179,
  "54521": -0.064,
  "54522": -0.136,
  "54523": -0.154,
  "54524": -0.210,
  "54525": -0.268,
  "54531": -0.087,
  "54532": -0.158,
  "54533": -0.177,
  "54534": -0.233,
  "54535": -0.291,
  "54541": -0.148,
  "54542": -0.219,
  "54543": -0.238,
  "54544": -0.294,
  "54545": -0.352,
  "54551": -0.240,
  "54552": -0.311,
  "54553": -0.330,
  "54554": -0.386,
  "54555": -0.444,
  "55111": 0.128,
  "55112": 0.057,
  "55113": 0.038,
  "55114": -0.018,
  "55115": -0.076,
  "55121": 0.038,
  "55122": -0.033,
  "55123": -0.052,
  "55124": -0.108,
  "55125": -0.166,
  "55131": 0.016,
  "55132": -0.055,
  "55133": -0.074,
  "55134": -0.130,
  "55135": -0.188,
  "55141": -0.045,
  "55142": -0.117,
  "55143": -0.135,
  "55144": -0.191,
  "55145": -0.249,
  "55151": -0.137,
  "55152": -0.208,
  "55153": -0.227,
  "55154": -0.283,
  "55155": -0.341,
  "55211": 0.003,
  "55212": -0.069,
  "55213": -0.087,
  "55214": -0.143,
  "55215": -0.201,
  "55221": -0.087,
  "55222": -0.158,
  "55223": -0.177,
  "55224": -0.233,
  "55225": -0.291,
  "55231": -0.109,
  "55232": -0.181,
  "55233": -0.199,
  "55234": -0.255,
  "55235": -0.313,
  "55241": -0.170,
  "55242": -0.242,
  "55243": -0.260,
  "55244": -0.316,
  "55245": -0.374,
  "55251": -0.262,
  "55252": -0.334,
  "55253": -0.352,
  "55254": -0.408,
  "55255": -0.466,
  "55311": -0.028,
  "55312": -0.099,
  "55313": -0.118,
  "55314": -0.174,
  "55315": -0.232,
  "55321": -0.118,
  "55322": -0.189,
  "55323": -0.208,
  "55324": -0.264,
  "55325": -0.322,
  "55331": -0.140,
  "55332": -0.211,
  "55333": -0.230,
  "55334": -0.286,
  "55335": -0.344,
  "55341": -0.201,
  "55342": -0.273,
  "55343": -0.291,
  "55344": -0.347,
  "55345": -0.405,
  "55351": -0.293,
  "55352": -0.364,
  "55353": -0.383,
  "55354": -0.439,
  "55355": -0.497,
  "55411": -0.039,
  "55412": -0.110,
  "55413": -0.129,
  "55414": -0.185,
  "55415": -0.243,
  "55421": -0.129,
  "55422": -0.200,
  "55423": -0.219,
  "55424": -0.275,
  "55425": -0.333,
  "55431": -0.151,
  "55432": -0.222,
  "55433": -0.241,
  "55434": -0.297,
  "55435": -0.355,
  "55441": -0.212,
  "55442": -0.283,
  "55443": -0.302,
  "55444": -0.358,
  "55445": -0.416,
  "55451": -0.304,
  "55452": -0.375,
  "55453": -0.394,
  "55454": -0.450,
  "55455": -0.508,
  "55511": -0.061,
  "55512": -0.132,
  "55513": -0.151,
  "55514": -0.207,
  "55515": -0.265,
  "55521": -0.151,
  "55522": -0.222,
  "55523": -0.241,
  "55524": -0.297,
  "55525": -0.355,
  "55531": -0.173,
  "55532": -0.244,
  "55533": -0.263,
  "55534": -0.319,
  "55535": -0.377,
  "55541": -0.234,
  "55542": -0.306,
  "55543": -0.324,
  "55544": -0.380,
  "55545": -0.438,
  "55551": -0.326,
  "55552": -0.397,
  "55553": -0.416,
  "55554": -0.472,
  "55555": -0.530
};

function calculateEq5d5lScore(
  mobility: number,
  selfCare: number,
  usualActivities: number,
  painDiscomfort: number,
  anxietyDepression: number,
  vasScore: number
): { profile: string; indexValue: number; interpretation: string } {
  // Generate 5-digit health state profile
  const profile = `${mobility}${selfCare}${usualActivities}${painDiscomfort}${anxietyDepression}`;
  
  // Look up utility index from France crosswalk table
  const indexValue = FRANCE_CROSSWALK[profile];
  
  if (indexValue === undefined) {
    throw new Error(`Profile ${profile} not found in France crosswalk table`);
  }
  
  // Build interpretation
  let interpretation = `Profil de santé: ${profile}. `;
  interpretation += `Score VAS: ${vasScore}/100. `;
  interpretation += `Index d'utilité (France): ${indexValue.toFixed(3)}. `;
  
  // Interpret profile
  if (profile === "11111") {
    interpretation += "État de santé optimal (aucun problème dans les 5 dimensions). ";
  } else if (profile === "55555") {
    interpretation += "État de santé le plus défavorable (problèmes extrêmes dans toutes les dimensions). ";
  } else {
    // Count dimensions with problems
    const dimensions = [mobility, selfCare, usualActivities, painDiscomfort, anxietyDepression];
    const problems = dimensions.filter(v => v > 1).length;
    const severeProblems = dimensions.filter(v => v >= 4).length;
    
    if (severeProblems > 0) {
      interpretation += `${severeProblems} dimension(s) avec problèmes sévères ou extrêmes. `;
    } else if (problems > 0) {
      interpretation += `${problems} dimension(s) avec problèmes. `;
    }
  }
  
  // Interpret VAS
  if (vasScore >= 80) {
    interpretation += "VAS élevé - bonne perception de l'état de santé. ";
  } else if (vasScore >= 50) {
    interpretation += "VAS moyen - perception modérée de l'état de santé. ";
  } else {
    interpretation += "VAS bas - perception défavorable de l'état de santé. ";
  }
  
  // Interpret utility index
  if (indexValue >= 0.8) {
    interpretation += "Index d'utilité élevé - très bonne qualité de vie. ";
  } else if (indexValue >= 0.5) {
    interpretation += "Index d'utilité modéré - qualité de vie acceptable. ";
  } else if (indexValue >= 0) {
    interpretation += "Index d'utilité bas - qualité de vie altérée. ";
  } else {
    interpretation += "Index d'utilité négatif - état jugé pire que la mort. ";
  }
  
  return {
    profile,
    indexValue: Number(indexValue.toFixed(3)),
    interpretation: interpretation.trim()
  };
}

export async function saveEq5d5lResponse(
  response: Eq5d5lResponseInsert
): Promise<Eq5d5lResponse> {
  const supabase = await createClient();
  const user = await supabase.auth.getUser();

  // Remove profile_string if present (it's a generated column)
  const { profile_string, ...responseWithoutGeneratedFields } = response as any;

  // Calculate EQ-5D-5L score using France crosswalk
  const { profile, indexValue, interpretation } = calculateEq5d5lScore(
    responseWithoutGeneratedFields.mobility,
    responseWithoutGeneratedFields.self_care,
    responseWithoutGeneratedFields.usual_activities,
    responseWithoutGeneratedFields.pain_discomfort,
    responseWithoutGeneratedFields.anxiety_depression,
    responseWithoutGeneratedFields.vas_score
  );

  const { data, error } = await supabase
    .from('responses_eq5d5l')
    .upsert({
      ...responseWithoutGeneratedFields,
      index_value: indexValue,
      interpretation,
      completed_by: user.data.user?.id
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// PRISE-M
export async function getPriseMResponse(
  visitId: string
): Promise<PriseMResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_prise_m')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function savePriseMResponse(
  response: PriseMResponseInsert
): Promise<PriseMResponse> {
  const supabase = await createClient();
  const user = await supabase.auth.getUser();

  // Remove demographic metadata fields that are not part of the table schema
  const { patient_age, patient_gender, patient_sex, ...responseData } = response as any;

  // Calculate section scores (updated for q1-q31 structure)
  const gastroScore = (responseData.q1 ?? 0) + (responseData.q2 ?? 0) + (responseData.q3 ?? 0) + (responseData.q4 ?? 0);
  const cardiacScore = (responseData.q5 ?? 0) + (responseData.q6 ?? 0) + (responseData.q7 ?? 0);
  const skinScore = (responseData.q8 ?? 0) + (responseData.q9 ?? 0) + (responseData.q10 ?? 0);
  const neuroScore = (responseData.q11 ?? 0) + (responseData.q12 ?? 0) + (responseData.q13 ?? 0) + (responseData.q14 ?? 0);
  const visionHearingScore = (responseData.q15 ?? 0) + (responseData.q16 ?? 0);
  const sleepScore = (responseData.q21 ?? 0) + (responseData.q22 ?? 0);
  
  // Updated: q25-q31 are "other" symptoms (was q26-q32)
  const otherScore = (responseData.q25 ?? 0) + (responseData.q26 ?? 0) + (responseData.q27 ?? 0) + 
                     (responseData.q28 ?? 0) + (responseData.q29 ?? 0) + (responseData.q30 ?? 0) + (responseData.q31 ?? 0);

  // Urogenital and sexual scores (q17-q20 for urogenital, q23-q24 for sexual)
  const urogenitalScore = (responseData.q17 ?? 0) + (responseData.q18 ?? 0) + (responseData.q19 ?? 0) + (responseData.q20 ?? 0);
  const sexualScore = (responseData.q23 ?? 0) + (responseData.q24 ?? 0);
  
  // Count items scored (all 31 questions)
  const itemsScored = 31;

  const totalScore = gastroScore + cardiacScore + skinScore + neuroScore + 
                     visionHearingScore + urogenitalScore + sleepScore + 
                     sexualScore + otherScore;

  const { data, error } = await supabase
    .from('responses_prise_m')
    .upsert({
      ...responseData,
      gastro_score: gastroScore,
      cardiac_score: cardiacScore,
      skin_score: skinScore,
      neuro_score: neuroScore,
      vision_hearing_score: visionHearingScore,
      urogenital_score: urogenitalScore,
      sleep_score: sleepScore,
      sexual_score: sexualScore,
      other_score: otherScore,
      total_score: totalScore,
      items_scored: itemsScored,
      completed_by: user.data.user?.id
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// STAI-YA
export async function getStaiYaResponse(
  visitId: string
): Promise<StaiYaResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_stai_ya')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveStaiYaResponse(
  response: StaiYaResponseInsert
): Promise<StaiYaResponse> {
  const supabase = await createClient();
  const user = await supabase.auth.getUser();

  // Remove instructions section if present
  const { instructions, ...responseData } = response as any;

  // Reverse score items: 1, 2, 5, 8, 10, 11, 15, 16, 19, 20
  const reverseItems = [1, 2, 5, 8, 10, 11, 15, 16, 19, 20];
  let totalScore = 0;

  for (let i = 1; i <= 20; i++) {
    const value = responseData[`q${i}` as keyof StaiYaResponseInsert] as number;
    if (reverseItems.includes(i)) {
      totalScore += (5 - value);
    } else {
      totalScore += value;
    }
  }

  let anxietyLevel = '';
  let interpretation = '';
  if (totalScore < 35) {
    anxietyLevel = 'very_low';
    interpretation = 'Anxiété état très faible';
  } else if (totalScore <= 45) {
    anxietyLevel = 'low';
    interpretation = 'Anxiété état faible';
  } else if (totalScore <= 55) {
    anxietyLevel = 'moderate';
    interpretation = 'Anxiété état moyenne';
  } else if (totalScore <= 65) {
    anxietyLevel = 'high';
    interpretation = 'Anxiété état élevée';
  } else {
    anxietyLevel = 'very_high';
    interpretation = 'Anxiété état très élevée';
  }

  const { data, error } = await supabase
    .from('responses_stai_ya')
    .upsert({
      ...responseData,
      total_score: totalScore,
      anxiety_level: anxietyLevel,
      interpretation,
      completed_by: user.data.user?.id
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// MARS
export async function getMarsResponse(
  visitId: string
): Promise<MarsResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_mars')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveMarsResponse(
  response: MarsResponseInsert
): Promise<MarsResponse> {
  const supabase = await createClient();
  const user = await supabase.auth.getUser();

  // Remove metadata fields that are not part of the table schema
  const { adherence_percentage, instructions, ...responseData } = response as any;

  // Calculate score only if taking medication
  let totalScore = 0;
  if (responseData.taking_medication === 'oui') {
    // MARS scoring: items 7,8 are positive (YES=1), others are negative (NO=1)
    const positiveItems = [7, 8];
    for (let i = 1; i <= 10; i++) {
      const value = responseData[`q${i}` as keyof MarsResponseInsert] as number;
      if (positiveItems.includes(i)) {
        totalScore += value; // YES=1, NO=0
      } else {
        totalScore += (1 - value); // NO=1, YES=0
      }
    }
  }

  const interpretation = responseData.taking_medication === 'oui' 
    ? (totalScore >= 7 ? 'Bonne adhérence' : 'Adhérence insuffisante')
    : 'Non applicable (pas de traitement)';

  const { data, error } = await supabase
    .from('responses_mars')
    .upsert({
      ...responseData,
      total_score: totalScore,
      interpretation,
      completed_by: user.data.user?.id
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// MAThyS
export async function getMathysResponse(
  visitId: string
): Promise<MathysResponse | null> {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from('responses_mathys')
    .select('*')
    .eq('visit_id', visitId)
    .single();

  if (error) {
    if (error.code === 'PGRST116') return null;
    throw error;
  }
  return data;
}

export async function saveMathysResponse(
  response: MathysResponseInsert
): Promise<MathysResponse> {
  const supabase = await createClient();
  const user = await supabase.auth.getUser();

  // Remove metadata fields that are not part of the table schema
  const { instructions, emotions_section, ...responseData } = response as any;

  // Reverse score items: 5, 6, 7, 8, 9, 10, 17, 18
  const reverseItems = [5, 6, 7, 8, 9, 10, 17, 18];
  
  // Apply reverse scoring and calculate subscales
  const processedScores: Record<number, number> = {};
  for (let i = 1; i <= 20; i++) {
    const rawValue = responseData[`q${i}` as keyof MathysResponseInsert] as number;
    if (reverseItems.includes(i)) {
      processedScores[i] = 10 - rawValue;
    } else {
      processedScores[i] = rawValue;
    }
  }
  
  // New Subscale calculations (Sums as per user request)
  const subscoreEmotion = processedScores[3] + processedScores[7] + processedScores[10] + processedScores[18];
  const subscoreMotivation = processedScores[2] + processedScores[11] + processedScores[12] + processedScores[15] + processedScores[16] + processedScores[17] + processedScores[19];
  const subscorePerception = processedScores[1] + processedScores[6] + processedScores[8] + processedScores[13] + processedScores[20];
  const subscoreInteraction = processedScores[4] + processedScores[14];
  const subscoreCognition = processedScores[5] + processedScores[9];
  
  const totalScore = subscoreEmotion + subscoreMotivation + subscorePerception + subscoreInteraction + subscoreCognition;
  
  const { data, error } = await supabase
    .from('responses_mathys')
    .upsert({
      ...responseData,
      emotional_hyperreactivity: Number((subscoreEmotion / 4).toFixed(2)),
      emotional_hyporeactivity: Number((subscoreMotivation / 7).toFixed(2)),
      cognitive_speed: Number((subscoreCognition / 2).toFixed(2)),
      motor_activity: Number((subscorePerception / 5).toFixed(2)),
      motivation: Number((subscoreInteraction / 2).toFixed(2)),
      subscore_emotion: subscoreEmotion,
      subscore_motivation: subscoreMotivation,
      subscore_perception: subscorePerception,
      subscore_interaction: subscoreInteraction,
      subscore_cognition: subscoreCognition,
      total_score: totalScore,
      completed_by: user.data.user?.id
    }, { onConflict: 'visit_id' })
    .select()
    .single();

  if (error) throw error;
  return data;
}

// ============================================================================
// Export functions from other service files
// ============================================================================

// Export remaining ETAT questionnaires
export {
  getPsqiResponse,
  savePsqiResponse,
  getEpworthResponse,
  saveEpworthResponse
} from './questionnaire-etat.service';

// Export TRAITS questionnaires  
export {
  getAsrsResponse,
  saveAsrsResponse,
  getCtqResponse,
  saveCtqResponse,
  getBis10Response,
  saveBis10Response,
  getAls18Response,
  saveAls18Response,
  getAimResponse,
  saveAimResponse,
  getWurs25Response,
  saveWurs25Response,
  getAq12Response,
  saveAq12Response,
  getCsmResponse,
  saveCsmResponse,
  getCtiResponse,
  saveCtiResponse
} from './questionnaire-traits.service';

// DSM5 exports
export { getDsm5HumeurResponse, saveDsm5HumeurResponse, getDsm5PsychoticResponse, saveDsm5PsychoticResponse, getDsm5ComorbidResponse, saveDsm5ComorbidResponse } from './questionnaire-dsm5.service';